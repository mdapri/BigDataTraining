<!DOCTYPE html>
<!-- saved from url=(0057)https://cwiki.apache.org/confluence/display/Hive/Tutorial -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	            <title>Tutorial - Apache Hive - Apache Software Foundation</title>
    
        

                        
    
                        
    

                
    
    <meta http-equiv="X-UA-Compatible" content="IE=EDGE,chrome=IE7">
<meta charset="UTF-8">
<!-- Deprecated since 3.4. To be removed in a future version of Confluence; use AJS.Confluence.getContextPath() -->
<meta id="confluence-context-path" name="confluence-context-path" content="/confluence">
<meta id="confluence-base-url" name="confluence-base-url" content="https://cwiki.apache.org/confluence">

<meta id="atlassian-token" name="atlassian-token" content="edf6646505fec038a7196f0e6c6e3cdfb8aea4f2">

<meta id="confluence-space-key" name="confluence-space-key" content="Hive">
<script type="text/javascript">
    // Deprecated global variables. To be removed in a future version of Confluence.
    var contextPath = '/confluence';
</script>

    

<!-- include system css resources -->


    <!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/confluence/s/en_GB-1988229788/4109/76e0dbb30bc8580e459c201f3535d84f9283a9ac.1/39/_/download/superbatch/css/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="./Tutorial - Apache Hive - Apache Software Foundation_files/batch.css" media="print">
<link type="text/css" rel="stylesheet" href="./Tutorial - Apache Hive - Apache Software Foundation_files/batch(1).css" media="all">
<!--[if gte IE 9]>
<link type="text/css" rel="stylesheet" href="/confluence/s/en_GB-1988229788/4109/76e0dbb30bc8580e459c201f3535d84f9283a9ac.1/39/_/download/superbatch/css/batch.css?conditionalComment=gte+IE+9" media="all">
<![endif]-->
<!--[if lte IE 8]>
<link type="text/css" rel="stylesheet" href="/confluence/s/en_GB-1988229788/4109/76e0dbb30bc8580e459c201f3535d84f9283a9ac.1/39/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+8" media="all">
<![endif]-->
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/confluence/s/en_GB-1988229788/4109/76e0dbb30bc8580e459c201f3535d84f9283a9ac.1/39/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/confluence/s/en_GB-1988229788/4109/76e0dbb30bc8580e459c201f3535d84f9283a9ac.1/709a76d38b5ac561d0cef5a523e77410/_/download/contextbatch/css/page/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="./Tutorial - Apache Hive - Apache Software Foundation_files/batch(2).css" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/confluence/s/en_GB-1988229788/4109/76e0dbb30bc8580e459c201f3535d84f9283a9ac.1/017312f8c03fc008ec7f1f86c896d3d8/_/download/contextbatch/css/viewcontent/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="./Tutorial - Apache Hive - Apache Software Foundation_files/batch(3).css" media="all">
<link type="text/css" rel="stylesheet" href="./Tutorial - Apache Hive - Apache Software Foundation_files/batch(4).css" media="all">
<link type="text/css" rel="stylesheet" href="./Tutorial - Apache Hive - Apache Software Foundation_files/batch(5).css" media="all">
<link type="text/css" rel="stylesheet" href="./Tutorial - Apache Hive - Apache Software Foundation_files/org.randombits.confluence.toc-toc-plugin-styles.css" media="all">
<link type="text/css" rel="stylesheet" href="./Tutorial - Apache Hive - Apache Software Foundation_files/com.atlassian.confluence.ext.newcode-macro-plugin-syntaxhighlighter.css" media="all">
<link type="text/css" rel="stylesheet" href="./Tutorial - Apache Hive - Apache Software Foundation_files/com.atlassian.confluence.ext.newcode-macro-plugin-sh-theme-default.css" media="all">
<link type="text/css" rel="stylesheet" href="./Tutorial - Apache Hive - Apache Software Foundation_files/confluence.extra.information-information-plugin-adg-styles.css" media="all">
<link type="text/css" rel="stylesheet" href="./Tutorial - Apache Hive - Apache Software Foundation_files/com.atlassian.confluence.plugins.confluence-space-ia-spacesidebar.css" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/confluence/s/en_GB-1988229788/4109/76e0dbb30bc8580e459c201f3535d84f9283a9ac.1/5.0.3/_/download/batch/com.atlassian.confluence.plugins.confluence-space-ia:spacesidebar/com.atlassian.confluence.plugins.confluence-space-ia:spacesidebar.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="./Tutorial - Apache Hive - Apache Software Foundation_files/com.atlassian.mywork.mywork-confluence-host-plugin-mw-header-anchor.css" media="all">
<link type="text/css" rel="stylesheet" href="./Tutorial - Apache Hive - Apache Software Foundation_files/colors.css" media="all">
<link type="text/css" rel="stylesheet" href="./Tutorial - Apache Hive - Apache Software Foundation_files/default-theme.css" media="all">

<!-- end system css resources -->

    <meta name="confluence-request-time" content="1424863757921">
<!-- Deprecated since 3.4. To be removed in a future version of Confluence; use atl.header -->
        
            <script type="text/x-template" title="share-content-popup">
    <form action="#" method="post" class="aui share-content-popup">
        <div class="field-group">
            <div class="autocomplete-user-target">
                <input class="text autocomplete-sharepage" id="users" data-max="10" data-dropdown-target=".autocomplete-user-target" data-none-message="No matching user or email found" placeholder="User name or email"/>
            </div>
            <ol class="recipients">
            </ol>
        </div>
        <div class="field-group">
            <textarea class="textarea" id="note" placeholder="Add an optional note"/>
        </div>
        <div class="field-group button-panel">
            <div class="progress-messages-icon"></div>
            <div class="progress-messages">
            </div>
            <input class="button submit" type="submit" value="Share" disabled/>
            <a class="close-dialog" href="#">Cancel</a>
        </div>
    </form>
</script>

<script type="text/x-template" title="share-content-popup-recipient-username">
    <li data-username="{username}" style="display: none">
        <span>
            <img src="{thumbnailLink.href}" title="{title}">
            <span>{title}</span>
            <span class="remove-recipient"/>
        </span>
    </li>
</script>

<script type="text/x-template" title="share-content-popup-recipient-email">
    <li data-email="{email}" style="display: none">
        <span>
            <img src="{icon}" title="{email}">
            <span>{email}</span>
            <span class="remove-recipient"/>
        </span>
    </li>
</script>
    
        
            <meta name="ajs-use-keyboard-shortcuts" content="true">
            <meta name="ajs-keyboardshortcut-hash" content="930f70e51dda96d6cb148385abc89367">
            <meta name="gliffy-license-type" content="OPEN_SOURCE">
<meta name="gliffy-license-quantity" content="-1">

            <script type="text/x-template" title="gliffy-webpanel-footer">
        <div class="gliffy-webpanel-footer"><span>This Confluence installation runs a Free Gliffy License - Evaluate the <a href="http://www.gliffy.com/products/confluence-plugin/">Gliffy Confluence Plugin</a> for your Wiki!</span></div>
</script>


            <meta name="ap-request-id" content="4e626ceca1b85bcd">
            <style>.ia-fixed-sidebar, .ia-splitter-left {width: 285px;}.theme-default .ia-splitter #main {margin-left: 285px;}.acs-side-bar {visibility: hidden;}</style>
            

    
            
    
    
            <meta name="ajs-page-id" content="27362061">
            <meta name="ajs-content-type" content="page">
            <meta name="ajs-page-title" content="Tutorial">
            <meta name="ajs-parent-page-id" content="">
            <meta name="ajs-space-key" content="Hive">
            <meta name="ajs-space-name" content="Apache Hive">
            <meta name="ajs-from-page-title" content="">
            <meta name="ajs-browse-page-tree-mode" content="view">
            <meta name="ajs-editor.loader.comment.resources" content="&lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; href=&quot;/confluence/s/en_GB-1988229788/4109/76e0dbb30bc8580e459c201f3535d84f9283a9ac.1/def88f1396f473dd83f398203309c7bb/_/download/contextbatch/css/comment-editor/batch.css&quot; media=&quot;all&quot;&gt;
">
            <meta name="ajs-context-path" content="/confluence">
            <meta name="ajs-base-url" content="https://cwiki.apache.org/confluence">
            <meta name="ajs-version-number" content="5.0.3">
            <meta name="ajs-build-number" content="4109">
            <meta name="ajs-remote-user" content="">
            <meta name="ajs-static-resource-url-prefix" content="/confluence/s/en_GB-1988229788/4109/76e0dbb30bc8580e459c201f3535d84f9283a9ac.1/_">
            <meta name="ajs-global-settings-attachment-max-size" content="20971520">
            <meta name="ajs-user-locale" content="en_GB">
            <meta name="ajs-enabled-dark-features" content="">
            <meta name="ajs-atl-token" content="edf6646505fec038a7196f0e6c6e3cdfb8aea4f2">
            <meta name="ajs-confluence-flavour" content="VANILLA">
            <meta name="ajs-editor.loader.resources" content="&lt;!--[if lt IE 9]&gt;
&lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; href=&quot;/confluence/s/en_GB-1988229788/4109/76e0dbb30bc8580e459c201f3535d84f9283a9ac.1/e88e5c074267cd8662f3f09e5e5daf28/_/download/contextbatch/css/editor,fullpage-editor,macro-browser,-viewcontent/batch.css?conditionalComment=lt+IE+9&quot; media=&quot;all&quot;&gt;
&lt;![endif]--&gt;
&lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; href=&quot;/confluence/s/en_GB-1988229788/4109/76e0dbb30bc8580e459c201f3535d84f9283a9ac.1/e88e5c074267cd8662f3f09e5e5daf28/_/download/contextbatch/css/editor,fullpage-editor,macro-browser,-viewcontent/batch.css&quot; media=&quot;all&quot;&gt;
&lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; href=&quot;/confluence/s/en_GB-1988229788/4109/76e0dbb30bc8580e459c201f3535d84f9283a9ac.1/e88e5c074267cd8662f3f09e5e5daf28/_/download/contextbatch/css/editor,fullpage-editor,macro-browser,-viewcontent/batch.css?media=%28max-width%3A+1270px%29&quot; media=&quot;(max-width: 1270px)&quot;&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;/confluence/s/en_GB-1988229788/4109/76e0dbb30bc8580e459c201f3535d84f9283a9ac.1/e88e5c074267cd8662f3f09e5e5daf28/_/download/contextbatch/js/editor,fullpage-editor,macro-browser,-viewcontent/batch.js&quot; &gt;&lt;/script&gt;
">
            <meta name="ajs-date.format" content="MMM dd, yyyy">
    
    <link rel="shortcut icon" href="https://cwiki.apache.org/confluence/favicon.ico">
    <link rel="icon" type="image/x-icon" href="https://cwiki.apache.org/confluence/favicon.ico">

<link rel="search" type="application/opensearchdescription+xml" href="https://cwiki.apache.org/confluence/opensearch/osd.action" title="Apache Software Foundation">

    <!-- include system javascript resources -->
    <script type="text/javascript" src="./Tutorial - Apache Hive - Apache Software Foundation_files/batch.js"></script>
<!--[if lte IE 8]>
<script type="text/javascript" src="/confluence/s/en_GB-1988229788/4109/76e0dbb30bc8580e459c201f3535d84f9283a9ac.1/39/_/download/superbatch/js/batch.js?conditionalComment=lte+IE+8" ></script>
<![endif]-->
<script type="text/javascript" src="./Tutorial - Apache Hive - Apache Software Foundation_files/batch(6).js"></script><style type="text/css">@charset "UTF-8";[ng\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak{display:none;}ng\:form{display:block;}</style>
<script type="text/javascript" src="./Tutorial - Apache Hive - Apache Software Foundation_files/batch(7).js"></script>
<script type="text/javascript" src="./Tutorial - Apache Hive - Apache Software Foundation_files/batch(8).js"></script>
<script type="text/javascript" src="./Tutorial - Apache Hive - Apache Software Foundation_files/batch(9).js"></script>
<script type="text/javascript" src="./Tutorial - Apache Hive - Apache Software Foundation_files/com.atlassian.confluence.ext.newcode-macro-plugin-syntaxhighlighter.js"></script>
<script type="text/javascript" src="./Tutorial - Apache Hive - Apache Software Foundation_files/com.atlassian.confluence.ext.newcode-macro-plugin-syntaxhighlighter-brushes.js"></script>
<script type="text/javascript" src="./Tutorial - Apache Hive - Apache Software Foundation_files/com.atlassian.confluence.plugins.confluence-space-ia-soy-resources.js"></script>
<script type="text/javascript" src="./Tutorial - Apache Hive - Apache Software Foundation_files/com.atlassian.confluence.plugins.editor-loader-background-loading-editor.js"></script>
<script type="text/javascript" src="./Tutorial - Apache Hive - Apache Software Foundation_files/com.atlassian.confluence.plugins.confluence-space-ia-spacesidebar.js"></script>
<script type="text/javascript" src="./Tutorial - Apache Hive - Apache Software Foundation_files/com.atlassian.mywork.mywork-confluence-host-plugin-mw-header-anchor.js"></script>

    

        
    <!-- end system javascript resources -->
    

    
                <link rel="canonical" href="./Tutorial - Apache Hive - Apache Software Foundation_files/Tutorial - Apache Hive - Apache Software Foundation.html">
        <link rel="shortlink" href="https://cwiki.apache.org/confluence/x/DYOhAQ">
    <meta name="wikilink" content="[Hive:Tutorial]">
    <meta name="page-version" content="32">

</head>

<body onload="placeFocus()" id="com-atlassian-confluence" class="theme-default  aui-layout aui-theme-default">

        
    <ul id="assistive-skip-links" class="assistive">
    <li><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#title-heading">Skip to content</a></li>
    <li><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#breadcrumbs">Skip to breadcrumbs</a></li>
    <li><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#header-menu-bar">Skip to header menu</a></li>
    <li><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#navigation">Skip to action menu</a></li>
    <li><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#quick-search-query">Skip to quick search</a></li>
</ul>
<div id="page">
<div id="full-height-container">
    <div id="header-precursor">
        <div class="cell">
            <style type="text/css">
#preview #previewArea iframe {

   overflow: visible;
}
</style>

                            </div>
    </div>
    



<header id="header" role="banner">
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation"><div class="aui-header-inner"><div class="aui-header-before"><a class="aui-dropdown2-trigger app-switcher-trigger" aria-owns="app-switcher" aria-haspopup="true" tabindex="0"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a><div id="app-switcher" class="aui-dropdown2 aui-style-default"><div class="aui-dropdown2-section"><ul class="nav-links"><li class="nav-link nav-link-local"><a href="https://cwiki.apache.org/confluence/" class="aui-dropdown2-radio interactive checked" title="https://cwiki.apache.org/confluence/"><span class="nav-link-label">Apache Software Foundation</span></a></li><li class="nav-link"><a href="https://issues.apache.org/jira" class="aui-dropdown2-radio interactive" title="https://issues.apache.org/jira"><span class="nav-link-label">ASF Jira</span></a></li></ul></div></div><script>
            (function (NL) {
                var initialise = function () {
                    // For some milestones of AUI, the atlassian soy namespace was renamed to aui. Handle that here by ensuring that window.atlassian is defined.
                    window.atlassian = window.atlassian || window.aui;
                    new NL.AppSwitcher({
                        dropdownContents: '#app-switcher'
                    });
                };
                if (NL.AppSwitcher) {
                    initialise();
                } else {
                    NL.onInit = initialise;
                }
            }(window.NL = (window.NL || {})));
            window.NL.isUserAdmin = false</script></div><div class="aui-header-primary"><h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://cwiki.apache.org/confluence/dashboard.action"><img src="./Tutorial - Apache Hive - Apache Software Foundation_files/confluence-logo.png" alt="Apache Software Foundation"></a></h1><ul class="aui-nav">
                            <li>
            
        
        
<a id="space-directory-link" href="https://cwiki.apache.org/confluence/spacedirectory/view.action" class=" aui-nav-imagelink" title="Spaces">
            <span>Spaces</span>
    </a>
        </li>
                        </ul>
</div><div class="aui-header-secondary"><ul class="aui-nav">
                <li>
<form id="quick-search" class="aui-quicksearch dont-default-focus" action="https://cwiki.apache.org/confluence/dosearchsite.action" method="get">
    <fieldset>
                        <label for="quick-search-query" class="assistive">Quick Search</label>
        <input id="quick-search-query" class="text app-search search quick-search-query" type="text" accesskey="q" autocomplete="off" name="queryString" title="Quick Search (/)" placeholder="Search">
        <input id="quick-search-submit" class="quick-search-submit" type="submit" value="Search">

        <div class="aui-dd-parent quick-nav-drop-down"></div>
    </fieldset>
    <div class="hidden parameters">
                    <!-- putMetadata failed to add value for key "quick-nav-enabled" so rendering metadata inline - see server debug log for details -->
        <meta name="ajs-quick-nav-enabled" content="true">
                </div>
</form>
</li>
    <li>    
        <a id="help-menu-link" class="aui-nav-link aui-dropdown2-trigger" href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" aria-haspopup="true" aria-owns="help-menu-link-content" title="Help">
        <span class="aui-icon aui-icon-small aui-iconfont-help">Help</span><span class="aui-icon-dropdown"></span>
    </a>
    <nav id="help-menu-link-content" class="aui-dropdown2 aui-style-default" aria-hidden="true">
                    <div class="aui-dropdown2-section">
                <ul id="help-menu-link-leading" class="aui-list-truncate section-leading first">
                                            <li>
    
        
<a id="confluence-help-link" href="http://docs.atlassian.com/confluence/docs-50/Getting+Help+And+Support" class="interactive" title="Visit the Confluence documentation home" target="_blank">
        Online Help
</a>
</li>
                                            <li>
    
        
<a id="keyboard-shortcuts-link" href="https://cwiki.apache.org/confluence" class="interactive" title="View available keyboard shortcuts (?)">
        Keyboard Shortcuts
</a>
</li>
                                            <li>
    
        
<a id="feed-builder-link" href="https://cwiki.apache.org/confluence/dashboard/configurerssfeed.action" class="interactive" title="Create your custom RSS feed.">
        Feed Builder
</a>
</li>
                                            <li>
    
        
<a id="whats-new-menu-link" href="http://docs.atlassian.com/confluence/docs-50/whatsnew/iframe" class="interactive" title="">
        What’s new
</a>
</li>
                                            <li>
    
        
<a id="gadget-directory-link" href="https://cwiki.apache.org/confluence" class="user-item administration-link  interactive" title="Browse gadgets provided by Confluence">
        Available Gadgets
</a>
</li>
                                    </ul>
            </div>
            </nav>
    </li>
    <li>    
    </li>
                <li>                                    </li><li>
    
        
<a id="login-link" href="https://cwiki.apache.org/confluence/login.action?os_destination=%2Fdisplay%2FHive%2FTutorial" class="   user-item login-link " title="">
        Log In
</a>
</li>
                        <li>
    
        
<a id="signup-link" href="https://cwiki.apache.org/confluence/signup.action" class="   user-item signup-link " title="">
        Sign Up
</a>
</li>
                        
</ul>
</div></div><!-- .aui-header-inner--></nav><!-- .aui-header -->
    <br class="clear">
</header>

    
    	<div class="ia-splitter">
    		<div class="ia-splitter-left">
    			<div class="ia-fixed-sidebar" style="width: 285px; top: 41px; left: 0px;">
    				
	    	<div class="acs-side-bar ia-scrollable-section" style="visibility: visible;"><div class="acs-side-bar-space-info tipsy-enabled" data-configure-tooltip="Edit Space Details"><div class="avatar"><div class="space-logo " data-key="Hive" data-name="Apache Hive" data-entity-type="confluence.space"><div class="avatar-img-container"><div class="avatar-img-wrapper"><a href="https://cwiki.apache.org/confluence/display/Hive" title="Apache Hive"><img class="avatar-img" src="./Tutorial - Apache Hive - Apache Software Foundation_files/Hive" alt="Apache Hive"></a></div></div></div></div><div class="name"><a href="https://cwiki.apache.org/confluence/display/Hive" title="Apache Hive">Apache Hive</a></div><div class="flyout-handle icon"></div></div><div class="acs-nav-wrapper"><div class="acs-nav"><div class="acs-nav-sections"><div class="main-links-section "><ul class="acs-nav-list"><li class="acs-nav-item wiki current-item" data-collector-key="spacebar-pages"><a class="acs-nav-item-link tipsy-enabled" href="https://cwiki.apache.org/confluence/collector/pages.action?key=Hive" data-collapsed-tooltip="Pages"><span class="icon"></span><span class="acs-nav-item-label">Pages</span></a></li><li class="acs-nav-item blog" data-collector-key="spacebar-blogs"><a class="acs-nav-item-link tipsy-enabled" href="https://cwiki.apache.org/confluence/pages/viewrecentblogposts.action?key=Hive" data-collapsed-tooltip="Blog"><span class="icon"></span><span class="acs-nav-item-label">Blog</span></a></li></ul></div><hr><div class="advanced-links-section tipsy-enabled " data-collapsed-tooltip="Space tools"><ul class="acs-nav-list"><li class="acs-nav-item settings" data-collector-key="spacebar-advanced"><a class="acs-nav-item-link tipsy-enabled" href="https://cwiki.apache.org/confluence/spaces/spacetools.action?key=Hive" data-collapsed-tooltip="Space tools"><span class="icon"></span><span class="acs-nav-item-label">Space tools</span></a></li></ul></div></div></div></div><div class="ia-secondary-container tipsy-enabled" data-tree-type="pages" data-collapsed-tooltip="Child pages"><hr><div class="ia-secondary-header"><h5 class="ia-secondary-header-title wiki current-item"><span class="icon"></span><span class="label">Tutorial</span></h5></div><div class="ia-secondary-content"></div></div><div class="hidden"><a href="https://cwiki.apache.org/confluence/collector/pages.action?key=Hive" id="space-pages-link" title=" (g , s)"></a><script type="text/x-template" title="logo-config-content"><h2>Space Details</h2><form id="crop-photo-form" class="aui" method="post" action="#"><div id="sidebar-logo-messages"></div><fieldset><div class="field-group"><label for="spaceName">Name</label><input autocomplete="off" name="spaceName" id="spaceName" class="text" maxlength="255" value="{spaceName}"><input type="hidden" name="spaceKey" id="spaceKey" value="Hive"><input type="hidden" name="offsetX" id="avatar-offsetX" value="-1"><input type="hidden" name="offsetY" id="avatar-offsetY" value="-1"><input type="hidden" name="width" id="avatar-width" value="-1"><input type="hidden" name="logoType" id="logoType" value="custom" data-last-value="custom"></div></fieldset></form><form id="upload-logo-form" class="aui" method="POST" action="#" enctype="multipart/form-data"><fieldset class="group"><legend><span>Logo</span></legend><div class="field-group"><input class="upload" type="file" id="upload-logo-input" name="upload-logo-input"></div><small ><a href="#" id="reset-logo">Reset to default logo</a></small><div id="image-holder" /></fieldset></form><div id="space-details-actions" class="buttons-container"><div class="buttons"><button class="aui-button save">Save</button><a href="#" class="aui-button aui-button-link cancel">Cancel</a></div></div></script></div></div>
    
    			<div class="ia-splitter-handle tipsy-enabled" data-tooltip="Collapse sidebar ( &#39;[&#39; )" title=" ([)"><div class="ia-splitter-handle-highlight"></div></div></div>
    		</div>
        <!-- \#header -->

        
        <div id="main" class=" aui-page-panel" style="margin-left: 285px;">
                <div id="main-header">
            
    <div id="navigation" class="content-navigation view">
                    <ul class="ajs-menu-bar">
                                    
                    
        <li class="normal ajs-menu-item">
        <a id="action-menu-link" class="action ajs-menu-title aui-dropdown2-trigger" href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" aria-haspopup="true" aria-owns="action-menu" data-container="#navigation"><span><span>Tools</span></span></a>         <div id="action-menu" class="aui-dropdown2 aui-style-default most-right-menu-item">
                            <ul id="action-menu-primary" class="section-primary first aui-dropdown2-section">
                                            <li>

    
        
    
    <a id="view-attachments-link" href="https://cwiki.apache.org/confluence/pages/viewpageattachments.action?pageId=27362061" class="action-view-attachments" accesskey="t" title="View Attachments (t)">
                <span>A<u>t</u>tachments (0)</span>    </a>
</li>
                                        <li>

    
        
    
    <a id="action-view-history-link" href="https://cwiki.apache.org/confluence/pages/viewpreviousversions.action?pageId=27362061" class="action-view-history" title="">
                <span>Page History</span>    </a>
</li>
                                        <li>

    
        
    
    <a id="action-page-permissions-link" href="https://cwiki.apache.org/confluence/pages/viewinfo.action?pageId=27362061" class="action-page-permissions" title="Edit restrictions">
                <span>Restrictions</span>    </a>
</li>
                                </ul>
                            <ul id="action-menu-secondary" class="section-secondary aui-dropdown2-section">
                                            <li>

    
        
    
    <a id="view-page-info-link" href="https://cwiki.apache.org/confluence/pages/viewinfo.action?pageId=27362061" class="action-view-info" title="">
                <span>Page Information</span>    </a>
</li>
                                        <li>

    
        
    
    <a id="link-to-page-link" href="https://cwiki.apache.org/confluence/pages/viewinfo.action?pageId=27362061" class="" title="Link to this Page (k)">
                <span>Link to this Page…</span>    </a>
</li>
                                        <li>

    
        
    
    <a id="view-in-hierarchy-link" href="https://cwiki.apache.org/confluence/pages/reorderpages.action?key=Hive&openId=27362061#selectedPageInHierarchy" class="" title="">
                <span>View in Hierarchy</span>    </a>
</li>
                                        <li>

    
        
    
    <a id="action-view-source-link" href="https://cwiki.apache.org/confluence/plugins/viewsource/viewpagesrc.action?pageId=27362061" class="action-view-source popup-link" title="">
                <span>View Source</span>    </a>
</li>
                                        <li>

    
        
    
    <a id="action-export-pdf-link" href="https://cwiki.apache.org/confluence/spaces/flyingpdf/pdfpageexport.action?pageId=27362061" class="" title="">
                <span>Export to PDF</span>    </a>
</li>
                                        <li>

    
        
    
    <a id="com-k15t-confluence-scroll-epub-launcher" href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=27362061" class="" title="">
                <span>Export to EPUB</span>    </a>
</li>
                                        <li>

    
        
    
    <a id="action-export-word-link" href="https://cwiki.apache.org/confluence/exportword?pageId=27362061" class="action-export-word" title="">
                <span>Export to Word</span>    </a>
</li>
                                </ul>
                            <ul id="action-menu-modify" class="section-modify aui-dropdown2-section">
                                            <li>

    
        
    
    <a id="treecopy-action" href="https://cwiki.apache.org/confluence/plugins/treecopy/setnames.action?pageId=27362061" class="" title="">
                <span>Copy Page Tree</span>    </a>
</li>
                                </ul>
                    </div>
    </li>
            </ul>
    </div>

            
            <h1 id="title-heading" class="pagetitle with-breadcrumbs">
                
                                    <div id="breadcrumb-section">
                        
    
    
    <ol id="breadcrumbs">
                    
                
        <li class="first">
                

                    <span class=""><a href="https://cwiki.apache.org/confluence/collector/pages.action?key=Hive">Pages</a></span>
                </li></ol>


                    </div>
                
                <span id="title-text" class="with-breadcrumbs">
                                                <a href="./Tutorial - Apache Hive - Apache Software Foundation_files/Tutorial - Apache Hive - Apache Software Foundation.html">Tutorial</a>
                                    </span>
            </h1>
        </div><!-- \#main-header -->
        
        

        <div id="sidebar-container">
                                                </div><!-- \#sidebar-container -->

        
    

                                                                                                                                                                                                                                                                                                                                                                                                                                                                      




        

    
    
        
    
    
                    
    

    




<div id="content" class="page view">
    

<div id="action-messages">
                        </div>



    
<script type="text/x-template" title="movePageDialog">
    <div class="row information">
        <div class="inner">
            <div class="element">
                Specify the new parent page for this page and its children by space and title.
            </div>
        </div>
    </div>
        <form class="aui" onsubmit="return false;">
	        <fieldset>
	                

    <legend class="assistive"><span>Change the Parent Page to a Known Page</span></legend>
	            <div class="field-group">
	                <label for="new-space">New space:</label>
	                <div class="value new-space-value">
	                    <input id="new-space-key" name="new-space-key" type="hidden" value="Hive">
	                    	                        <span class="space-input">
	                            <input id="new-space" name="new-space" value="Apache Hive" disabled="disabled" class="text long-field">
	                        </span>
                            <div class="description warning">You cannot move this page to another space because you do not have permission to remove it from this space.</div>
	                    	                    <div class="new-space-dropdown aui-dd-parent autocomplete"></div>
	                </div>
	            </div>
	            <div class="field-group">
	                <label for="new-parent-page">New parent page:</label>
	                <div class="value new-parent-page-value">
	                    <span class="page-input">
	                        <input id="new-parent-page" name="new-parent-page" value="" class="text long-field">
	                    </span>
                        <div class="description">Start typing a page title to see a list of suggestions.</div>
	                    <div class="new-parent-page-dropdown aui-dd-parent autocomplete"></div>
	                </div>
	            </div>
	        </fieldset>
        </form>
    <div class="location-info">
        <div class="row">
            <label>Current location:</label>
            <div class="value breadcrumbs-container">
                <div class="breadcrumbs-line">
                    <ul id="current-parent-breadcrumbs" class="breadcrumbs">
                    </ul>
                </div>
            </div>
        </div>
        <div class="row">
            <label>New location:</label>
            <div class="value breadcrumbs-container">
                <div class="breadcrumbs-line">
                    <ul id="new-parent-breadcrumbs" class="breadcrumbs">
                    </ul>
                </div>
            </div>
        </div>
    </div>
</script>

<script type="text/x-template" title="movePageSearchPanel">
    <div class="row information">
        <div class="inner">
            <div class="element">
                Search for and select the new parent page for this page and its children.
            </div>
        </div>
    </div>
    <div id="move-page-search-container" class="row">
	        <form class="aui" onsubmit="return false;">
	            <fieldset>
	                    

    <legend class="assistive"><span>Search for a New Parent Page</span></legend>
	                    

    <label  for="move-page-search-query" class="assistive">Search keywords</label>
	                <input class="search-query text" id="move-page-search-query">
	                    

    <label  for="move-page-search-space" class="assistive">Search in space</label>
	                	                    <select id="move-page-search-space" class="search-space select" disabled="disabled">
	                        <option value="Hive" selected="selected">Apache Hive</option>
	                    </select>
	                	                <input type="button" value="Search" class="button submit">
	                	                    <div class="description warning">You cannot move this page to another space because you do not have permission to remove it from this space.</div>
	                	            </fieldset>
	        </form>
        <div class="search-results">
        </div>
    </div>
</script>
<script type="text/x-template" title="searchResultsGrid">
    <table class="aui">
        <thead>
            <tr class="header">
                <th class="search-result-title">Page Title</th>
                <th class="search-result-space">Space</th>
                <th class="search-result-date">Updated</th>
            </tr>
        </thead>
    </table>
</script>
<script type="text/x-template" title="searchResultsGridCount">
    <p class="search-result-count">{0}</p>
</script>
<script type="text/x-template" title="searchResultsGridRow">
    <tr class="search-result">
        <th class="search-result-title"><a href="{1}" class="content-type-{2}"><span>{0}</span></a></th>
        <td class="search-result-space"><a class="space" href="/confluence/display/{4}/" title="{3}">{3}</a></td>
        <td class="search-result-date"><span class="date" title="{6}">{5}</span></td>
    </tr>
</script><!-- Start restrictions section -->
<script type="text/x-template" title="page-permissions-div">
<div id="page-permissions-div">
    <div id="page-permissions-editor-form">
                <div id="page-permissions-error-div" class="aui-message warning shadowed closeable hidden">
            <p class="title"/>
            <span class="aui-icon icon-warning"></span>
            <span class="aui-icon icon-close" tabindex="0" role="button"></span>
        </div>
                <div id="page-permissions-type-radios" class="page-permissions-label-rows">
            <div class="radio">
                <input id="restrictViewRadio" class="radio" type="radio" checked="checked" name="pagePermissionTypeRadio" value="view"/>
                <label for="restrictViewRadio">Restrict viewing of this page</label>
                <input id="restrictEditRadio" class="radio" type="radio" name="pagePermissionTypeRadio" value="edit"/>
                <label for="restrictEditRadio">Restrict editing of this page</label>
            </div>
        </div>
        <div id="page-permissions-input" class="page-permissions-label-rows">
            <div class="page-permissions-label">To:</div>
            <div id="page-permissions-chooser-box">
                                <span id="page-permissions-choose-user" class="aui-button">
                    


    
    






<a id='userpicker-popup-link'  href='#' onClick="var picker = window.open('/confluence/spaces/openuserpicker.action?key=Hive&amp;startIndex=0&amp;onPopupSubmit=AJS.PagePermissions.addUserPermissions', 'EntitiesPicker', 'status=yes,resizable=yes,top=100,left=200,width=700,height=680,scrollbars=yes'); picker.focus(); return false;">
    				    <img src="/confluence/s/en_GB-1988229788/4109/76e0dbb30bc8580e459c201f3535d84f9283a9ac.1/_/images/icons/user_16.png" height=16 width=16 border=0 align="absmiddle"  title="Choose users" />
						    Person...
	        </a>


                </span>
                <span id="page-permissions-choose-group" class="aui-button">
                    


    
    

 




<a id='grouppicker-popup-link'  href='#' onClick="var picker = window.open('/confluence/spaces/opengrouppicker.action?key=Hive&amp;startIndex=0&amp;actionName=dosearchgroups.action&amp;onPopupSubmit=AJS.PagePermissions.addGroupPermissions', 'EntitiesPicker', 'status=yes,resizable=yes,top=100,left=200,width=580,height=550,scrollbars=yes'); picker.focus(); return false;">
    				    <img src="/confluence/s/en_GB-1988229788/4109/76e0dbb30bc8580e459c201f3535d84f9283a9ac.1/_/images/icons/group_16.png" height=16 width=16 border=0 align="absmiddle"  title="Choose groups" />
						    Group...
	        </a>


                </span>
            </div>
            <div id="page-permissions-input-box">
                <input id="page-permissions-names-input" class="autocomplete-user text" type="text" name="permissionNames"
                    placeholder="Enter user or group name:"
                    data-max="10" data-none-message="No matches"
                    data-target="#page-permissions-names-hidden" data-template="{username}"
                    data-dropdown-target="#page-perms-name-dropdown-wrapper" data-resize-to-input="true"
                    size="30"/>
                <input
    type="hidden"
                            id="page-permissions-names-hidden"           />                <button class="aui-button" id="add-typed-names">Restrict</button>
                <div id="page-perms-name-dropdown-wrapper" class="aui-dd-parent autocomplete autocomplete-user-target"></div>
            </div>
        </div>
    </div>
    <div id="page-permissions-tables">
        <div id="page-permissions-table-div">
                        <table id="page-permissions-table" class="page-permissions-table">
                <tr id="page-permissions-no-views" class="marker-row">
                    <td colspan="3" class="page-permissions-marker-cell">
                            <span class="aui-icon aui-icon-small aui-iconfont-view"></span>
                        <span>No view restrictions are defined for this page</span>
                    </td>
                </tr>
                <tr id="page-permissions-no-edits" class="marker-row">
                    <td colspan="3" class="page-permissions-marker-cell">
                            <span class="aui-icon aui-icon-small edit-icon"></span>
                        <span>No edit restrictions are defined for this page</span>
                    </td>
                </tr>
            </table>
        </div>
        <div id="page-inherited-permissions-table-div" class="hidden">
            <span id="page-inherited-permissions-table-desc">
                <a class="icon twisty-closed">Show/Hide</a>
                <a id="toggle-inherited-permissions" title="Click to see inherited restrictions">This page has restricted parent pages. It can only be seen by users who can see those parent pages.</a>
            </span>
            <div id="page-inherited-permissions-tables" class="hidden page-inheritance-togglable"></div>
        </div>
    </div>
</div>
</script>

<!-- End restrictions section -->

        
    
            
                            
    

                    

        
        <a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#page-metadata-end" class="assistive">Skip to end of metadata</a>
<div id="page-metadata-start" class="assistive"></div>

    <div class="page-metadata">
        <ul>
                            <li class="page-metadata-item noprint">

    
            
    
    <a id="content-metadata-page-restrictions" href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="page-metadata-icon page-restrictions hidden" title="Page restrictions apply. Click the lock icon to view or edit the restriction.">
                <span>Page restrictions apply</span>    </a>
</li>
                        <li class="page-metadata-modification-info">
                                    Added by <a href="https://cwiki.apache.org/confluence/display/~admin" class="url fn">Confluence Administrator</a>, last edited by <a href="https://cwiki.apache.org/confluence/display/~erwaman" class="url fn">Anthony Hsu</a> on Mar 31, 2014
                                                                <span class="noprint">&nbsp;(<a id="view-change-link" href="https://cwiki.apache.org/confluence/pages/diffpages.action?pageId=27362061&originalId=40506761">view change</a>)</span>
                                                </li>
                            <li class="show-hide-comment-link">
                    <a id="show-version-comment" class="inline-control-link" href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#">show comment</a>
                    <a id="hide-version-comment" class="inline-control-link" style="display:none;" href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#">hide comment</a>
                </li>
                    </ul>
                <div id="version-comment" class="noteMacro" style="display: none;">
        <strong>Comment:</strong>
        Updated "Array Operations" section and added example of creating table with array column<br>
    </div>
        </div>


<a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#page-metadata-start" class="assistive">Go to start of metadata</a>
<div id="page-metadata-end" class="assistive"></div>
        
                                
        <div id="main-content" class="wiki-content">
                           <h1 id="Tutorial-HiveTutorial"><strong>Hive Tutorial</strong></h1><hr><p><style type="text/css">/*<![CDATA[*/
div.rbtoc1424863759575 {padding: 0px;}
div.rbtoc1424863759575 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1424863759575 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style></p><div class="toc-macro rbtoc1424863759575">
<ul class="toc-indentation">
<li><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#Tutorial-HiveTutorial">Hive Tutorial</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#Tutorial-Concepts">Concepts</a>
<ul class="toc-indentation">
<li><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#Tutorial-WhatIsHive">What Is Hive</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#Tutorial-WhatHiveIsNOT">What Hive Is NOT</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#Tutorial-DataUnits">Data Units</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#Tutorial-TypeSystem">Type System</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#Tutorial-BuiltInOperatorsandFunctions">Built In Operators and Functions</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#Tutorial-LanguageCapabilities">Language Capabilities</a></li>
</ul>
</li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#Tutorial-UsageandExamples">Usage and Examples</a></li>
</ul>
</div><p></p><h1 id="Tutorial-Concepts">Concepts</h1><h2 id="Tutorial-WhatIsHive">What Is Hive</h2><p>Hive is a data warehousing infrastructure based on <a href="http://hadoop.apache.org/" class="external-link" rel="nofollow">Hadoop</a>. Hadoop provides massive scale out and fault tolerance capabilities for data storage and processing (using the map-reduce programming paradigm) on commodity hardware.</p><p>Hive is designed to enable easy data summarization, ad-hoc querying and analysis of large volumes of data. It provides a simple query language called Hive QL, which is based on SQL and which enables users familiar with SQL to do ad-hoc querying, summarization and data analysis easily. At the same time, Hive QL also allows traditional map/reduce programmers to be able to plug in their custom mappers and reducers to do more sophisticated analysis that may not be supported by the built-in capabilities of the language.</p><h2 id="Tutorial-WhatHiveIsNOT">What Hive Is NOT</h2><p>Hadoop is a batch processing system and Hadoop jobs tend to have high latency and incur substantial overheads in job submission and scheduling. As a result - latency for Hive queries is generally very high (minutes) even when data sets involved are very small (say a few hundred megabytes). As a result it cannot be compared with systems such as Oracle where analyses are conducted on a significantly smaller amount of data but the analyses proceed much more iteratively with the response times between iterations being less than a few minutes. Hive aims to provide acceptable (but not optimal) latency for interactive data browsing, queries over small data sets or test queries.</p><p>Hive is not designed for online transaction processing and does not offer real-time queries and row level updates. It is best used for batch jobs over large sets of immutable data (like web logs).</p><p>In the following sections we provide a tutorial on the capabilities of the system. We start by describing the concepts of data types, tables and partitions (which are very similar to what you would find in a traditional relational DBMS) and then illustrate the capabilities of the QL language with the help of some examples.</p><h2 id="Tutorial-DataUnits">Data Units</h2><p>In the order of granularity - Hive data is organized into:</p><ul><li><strong>Databases</strong>: Namespaces that separate tables and other data units from naming confliction.</li><li><strong>Tables</strong>: Homogeneous units of data which have the same schema. An example of a table could be page_views table, where each row could comprise of the following columns (schema):<ul><li>timestamp - which is of INT type that corresponds to a unix timestamp of when the page was viewed.</li><li>userid - which is of BIGINT type that identifies the user who viewed the page.</li><li>page_url - which is of STRING type that captures the location of the page.</li><li>referer_url - which is of STRING that captures the location of the page from where the user arrived at the current page.</li><li>IP - which is of STRING type that captures the IP address from where the page request was made.</li></ul></li><li><strong>Partitions</strong>: Each Table can have one or more partition Keys which determines how the data is stored. Partitions - apart from being storage units - also allow the user to efficiently identify the rows that satisfy a certain criteria. For example, a date_partition of type STRING and country_partition of type STRING. Each unique value of the partition keys defines a partition of the Table. For example all "US" data from "2009-12-23" is a partition of the page_views table. Therefore, if you run analysis on only the "US" data for 2009-12-23, you can run that query only on the relevant partition of the table thereby speeding up the analysis significantly. Note however, that just because a partition is named 2009-12-23 does not mean that it contains all or only data from that date; partitions are named after dates for convenience but it is the user's job to guarantee the relationship between partition name and data content!). Partition columns are virtual columns, they are not part of the data itself but are derived on load.</li><li><strong>Buckets</strong> (or <strong>Clusters</strong>): Data in each partition may in turn be divided into Buckets based on the value of a hash function of some column of the Table. For example the page_views table may be bucketed by userid, which is one of the columns, other than the partitions columns, of the page_view table. These can be used to efficiently sample the data.</li></ul><p>Note that it is not necessary for tables to be partitioned or bucketed, but these abstractions allow the system to prune large quantities of data during query processing, resulting in faster query execution.</p><h2 id="Tutorial-TypeSystem">Type System</h2><p>Hive supports primitive and complex data types, as described below. See <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+Types">Hive Data Types</a> for additional information.</p><h3 id="Tutorial-PrimitiveTypes">Primitive Types</h3><ul><li>Types are associated with the columns in the tables. The following Primitive types are supported:</li><li>Integers<ul><li>TINYINT - 1 byte integer</li><li>SMALLINT - 2 byte integer</li><li>INT - 4 byte integer</li><li>BIGINT - 8 byte integer</li></ul></li><li>Boolean type<ul><li>BOOLEAN - TRUE/FALSE</li></ul></li><li>Floating point numbers<ul><li>FLOAT - single precision</li><li>DOUBLE - Double precision</li></ul></li><li>String type<ul><li>STRING - sequence of characters in a specified character set</li></ul></li></ul><p>The Types are organized in the following hierarchy (where the parent is a super type of all the children instances):</p><ul><li>Type<ul><li><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><p>Primitive Type</p></td></tr></tbody></table></div><ul><li><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><p>Number</p></td></tr></tbody></table></div><ul><li><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><p>DOUBLE</p></td></tr></tbody></table></div><ul><li><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><p>FLOAT</p></td></tr></tbody></table></div><ul><li><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><p>BIGINT</p></td></tr></tbody></table></div><ul><li><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><p>INT</p></td></tr></tbody></table></div><ul><li><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><p>SMALLINT</p></td></tr></tbody></table></div><ul><li><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><p>TINYINT</p></td></tr></tbody></table></div></li></ul></li></ul></li></ul></li></ul></li><li><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><p>STRING</p></td></tr></tbody></table></div></li></ul></li></ul></li><li><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><p>BOOLEAN</p></td></tr></tbody></table></div></li></ul></li></ul></li></ul><p>This type hierarchy defines how the types are implicitly converted in the query language. Implicit conversion is allowed for types from child to an ancestor. So when a query expression expects type1 and the data is of type2, type2 is implicitly converted to type1 if type1 is an ancestor of type2 in the type hierarchy. Note that the type hierarchy allows the implicit conversion of STRING to DOUBLE.</p><p>Explicit type conversion can be done using the cast operator as shown in the <a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#Tutorial-BuiltInFunctions">#Built In Functions</a> section below.</p><h3 id="Tutorial-ComplexTypes">Complex Types</h3><p>Complex Types can be built up from primitive types and other composite types using:</p><ul><li>Structs: the elements within the type can be accessed using the DOT (.) notation. For example, for a column c of type STRUCT {a INT; b INT} the a field is accessed by the expression c.a</li><li>Maps (key-value tuples): The elements are accessed using ['element name'] notation. For example in a map M comprising of a mapping from 'group' -&gt; gid the gid value can be accessed using M['group']</li><li>Arrays (indexable lists): The elements in the array have to be in the same type. Elements can be accessed using the [n] notation where n is an index (zero-based) into the array. For example for an array A having the elements ['a', 'b', 'c'], A[1] retruns 'b'.</li></ul><p>Using the primitive types and the constructs for creating complex types, types with arbitrary levels of nesting can be created. For example, a type User may comprise of the following fields:</p><ul><li>gender - which is a STRING.</li><li>active - which is a BOOLEAN.</li></ul><h2 id="Tutorial-BuiltInOperatorsandFunctions">Built In Operators and Functions</h2><p>The operators and functions listed below are not necessarily up-to-date. (<a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF">Hive Operators and UDFs</a> has more current information.) In the CLI, use these commands to show the latest documentation:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_261664" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">SHOW FUNCTIONS;</code></div><div class="line number2 index1 alt1"><code class="java plain">DESCRIBE FUNCTION &lt;function_name&gt;;</code></div><div class="line number3 index2 alt2"><code class="java plain">DESCRIBE FUNCTION EXTENDED &lt;function_name&gt;;</code></div></div></td></tr></tbody></table></div></div>
</div></div>    <div class="aui-message success shadowed information-macro">
                    <p class="title">Case-insensitive</p>
                            <span class="aui-icon icon-success">Icon</span>
                <div class="message-content">
                            <p>All Hive keywords are case-insensitive, including the names of Hive operators and functions.</p>
                    </div>
    </div>
<h3 id="Tutorial-BuiltInOperators">Built In Operators</h3><ul><li><strong>Relational Operators</strong> - The following operators compare the passed operands and generate a TRUE or FALSE value depending on whether the comparison between the operands holds or not.</li></ul><div class="table-wrap"><table class="confluenceTable tablesorter"><thead><tr class="sortableHeader"><th class="confluenceTh sortableHeader" data-column="0"><div class="tablesorter-header-inner"><p><strong>Relational Operator</strong></p></div></th><th class="confluenceTh sortableHeader" data-column="1"><div class="tablesorter-header-inner"><p><strong>Operand types</strong></p></div></th><th class="confluenceTh sortableHeader" data-column="2"><div class="tablesorter-header-inner"><p><strong>Description</strong></p></div></th></tr></thead><tbody><tr><td class="confluenceTd"><p>A = B</p></td><td class="confluenceTd"><p>all primitive types</p></td><td class="confluenceTd"><p>TRUE if expression A is equivalent to expression B otherwise FALSE</p></td></tr><tr><td class="confluenceTd"><p>A != B</p></td><td class="confluenceTd"><p>all primitive types</p></td><td class="confluenceTd"><p>TRUE if expression A is <em>not</em> equivalent to expression B otherwise FALSE</p></td></tr><tr><td class="confluenceTd"><p>A &lt; B</p></td><td class="confluenceTd"><p>all primitive types</p></td><td class="confluenceTd"><p>TRUE if expression A is less than expression B otherwise FALSE</p></td></tr><tr><td class="confluenceTd"><p>A &lt;= B</p></td><td class="confluenceTd"><p>all primitive types</p></td><td class="confluenceTd"><p>TRUE if expression A is less than or equal to expression B otherwise FALSE</p></td></tr><tr><td class="confluenceTd"><p>A &gt; B</p></td><td class="confluenceTd"><p>all primitive types</p></td><td class="confluenceTd"><p>TRUE if expression A is greater than expression B otherwise FALSE</p></td></tr><tr><td class="confluenceTd"><p>A &gt;= B</p></td><td class="confluenceTd"><p>all primitive types</p></td><td class="confluenceTd"><p>TRUE if expression A is greater than or equal to expression B otherwise FALSE</p></td></tr><tr><td class="confluenceTd"><p>A IS NULL</p></td><td class="confluenceTd"><p>all types</p></td><td class="confluenceTd"><p>TRUE if expression A evaluates to NULL otherwise FALSE</p></td></tr><tr><td class="confluenceTd"><p>A IS NOT NULL</p></td><td class="confluenceTd"><p>all types</p></td><td class="confluenceTd"><p>FALSE if expression A evaluates to NULL otherwise TRUE</p></td></tr><tr><td class="confluenceTd"><p>A LIKE B</p></td><td class="confluenceTd"><p>strings</p></td><td class="confluenceTd"><p>TRUE if string A matches the SQL simple regular expression B, otherwise FALSE. The comparison is done character by character. The _ character in B matches any character in A (similar to . in posix regular expressions), and the % character in B matches an arbitrary number of characters in A (similar to .* in posix regular expressions). For example, <code>'foobar' LIKE 'foo'</code> evaluates to FALSE where as <code>'foobar' LIKE 'foo___'</code> evaluates to TRUE and so does <code>'foobar' LIKE 'foo%'</code>. To escape % use \ (% matches one % character). If the data contains a semi-colon, and you want to search for it, it needs to be escaped, <code>columnValue LIKE 'a\;b'</code></p></td></tr><tr><td class="confluenceTd"><p>A RLIKE B</p></td><td class="confluenceTd"><p>strings</p></td><td class="confluenceTd"><p>NULL if A or B is NULL, TRUE if any (possibly empty) substring of A matches the Java regular expression B (see <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/util/regex/Pattern.html" class="external-link" rel="nofollow">Java regular expressions syntax</a>), otherwise FALSE. For example, 'foobar' rlike 'foo' evaluates to TRUE and so does 'foobar' rlike '^f.*r$'.</p></td></tr><tr><td class="confluenceTd"><p>A REGEXP B</p></td><td class="confluenceTd"><p>strings</p></td><td class="confluenceTd"><p>Same as RLIKE</p></td></tr></tbody></table></div><ul><li><strong>Arithmetic Operators</strong> - The following operators support various common arithmetic operations on the operands. All of them return number types.</li></ul><div class="table-wrap"><table class="confluenceTable tablesorter"><thead><tr class="sortableHeader"><th class="confluenceTh sortableHeader" data-column="0"><div class="tablesorter-header-inner"><p><strong>Arithmetic Operators</strong></p></div></th><th class="confluenceTh sortableHeader" data-column="1"><div class="tablesorter-header-inner"><p><strong>Operand types</strong></p></div></th><th class="confluenceTh sortableHeader" data-column="2"><div class="tablesorter-header-inner"><p><strong>Description</strong></p></div></th></tr></thead><tbody><tr><td class="confluenceTd"><p>A + B</p></td><td class="confluenceTd"><p>all number types</p></td><td class="confluenceTd"><p>Gives the result of adding A and B. The type of the result is the same as the common parent(in the type hierarchy) of the types of the operands. e.g. since every integer is a float, therefore float is a containing type of integer so the + operator on a float and an int will result in a float.</p></td></tr><tr><td class="confluenceTd"><p>A - B</p></td><td class="confluenceTd"><p>all number types</p></td><td class="confluenceTd"><p>Gives the result of subtracting B from A. The type of the result is the same as the common parent(in the type hierarchy) of the types of the operands.</p></td></tr><tr><td class="confluenceTd"><p>A * B</p></td><td class="confluenceTd"><p>all number types</p></td><td class="confluenceTd"><p>Gives the result of multiplying A and B. The type of the result is the same as the common parent(in the type hierarchy) of the types of the operands. Note that if the multiplication causing overflow, you will have to cast one of the operators to a type higher in the type hierarchy.</p></td></tr><tr><td class="confluenceTd"><p>A / B</p></td><td class="confluenceTd"><p>all number types</p></td><td class="confluenceTd"><p>Gives the result of dividing B from A. The type of the result is the same as the common parent(in the type hierarchy) of the types of the operands. If the operands are integer types, then the result is the quotient of the division.</p></td></tr><tr><td class="confluenceTd"><p>A % B</p></td><td class="confluenceTd"><p>all number types</p></td><td class="confluenceTd"><p>Gives the reminder resulting from dividing A by B. The type of the result is the same as the common parent(in the type hierarchy) of the types of the operands.</p></td></tr><tr><td class="confluenceTd"><p>A &amp; B</p></td><td class="confluenceTd"><p>all number types</p></td><td class="confluenceTd"><p>Gives the result of bitwise AND of A and B. The type of the result is the same as the common parent(in the type hierarchy) of the types of the operands.</p></td></tr><tr><td class="confluenceTd"><p>A | B</p></td><td class="confluenceTd"><p>all number types</p></td><td class="confluenceTd"><p>Gives the result of bitwise OR of A and B. The type of the result is the same as the common parent(in the type hierarchy) of the types of the operands.</p></td></tr><tr><td class="confluenceTd"><p>A ^ B</p></td><td class="confluenceTd"><p>all number types</p></td><td class="confluenceTd"><p>Gives the result of bitwise XOR of A and B. The type of the result is the same as the common parent(in the type hierarchy) of the types of the operands.</p></td></tr><tr><td class="confluenceTd"><p>~A</p></td><td class="confluenceTd"><p>all number types</p></td><td class="confluenceTd"><p>Gives the result of bitwise NOT of A. The type of the result is the same as the type of A.</p></td></tr></tbody></table></div><ul><li><strong>Logical Operators</strong> - The following operators provide support for creating logical expressions. All of them return boolean TRUE or FALSE depending upon the boolean values of the operands.</li></ul><div class="table-wrap"><table class="confluenceTable tablesorter"><thead><tr class="sortableHeader"><th class="confluenceTh sortableHeader" data-column="0"><div class="tablesorter-header-inner"><p><strong>Logical Operators</strong></p></div></th><th class="confluenceTh sortableHeader" data-column="1"><div class="tablesorter-header-inner"><p><strong>Operands types</strong></p></div></th><th class="confluenceTh sortableHeader" data-column="2"><div class="tablesorter-header-inner"><p><strong>Description</strong></p></div></th></tr></thead><tbody><tr><td class="confluenceTd"><p>A AND B</p></td><td class="confluenceTd"><p>boolean</p></td><td class="confluenceTd"><p>TRUE if both A and B are TRUE, otherwise FALSE</p></td></tr><tr><td class="confluenceTd"><p>A &amp;&amp; B</p></td><td class="confluenceTd"><p>boolean</p></td><td class="confluenceTd"><p>Same as A AND B</p></td></tr><tr><td class="confluenceTd"><p>A OR B</p></td><td class="confluenceTd"><p>boolean</p></td><td class="confluenceTd"><p>TRUE if either A or B or both are TRUE, otherwise FALSE</p></td></tr><tr><td class="confluenceTd"><p>A || B</p></td><td class="confluenceTd"><p>boolean</p></td><td class="confluenceTd"><p>Same as A OR B</p></td></tr><tr><td class="confluenceTd"><p>NOT A</p></td><td class="confluenceTd"><p>boolean</p></td><td class="confluenceTd"><p>TRUE if A is FALSE, otherwise FALSE</p></td></tr><tr><td class="confluenceTd"><p>!A</p></td><td class="confluenceTd"><p>boolean</p></td><td class="confluenceTd"><p>Same as NOT A</p></td></tr></tbody></table></div><ul><li><strong>Operators on Complex Types</strong> - The following operators provide mechanisms to access elements in Complex Types</li></ul><div class="table-wrap"><table class="confluenceTable tablesorter"><thead><tr class="sortableHeader"><th class="confluenceTh sortableHeader" data-column="0"><div class="tablesorter-header-inner"><p><strong>Operator</strong></p></div></th><th class="confluenceTh sortableHeader" data-column="1"><div class="tablesorter-header-inner"><p><strong>Operand types</strong></p></div></th><th class="confluenceTh sortableHeader" data-column="2"><div class="tablesorter-header-inner"><p><strong>Description</strong></p></div></th></tr></thead><tbody><tr><td class="confluenceTd"><p>A[n]</p></td><td class="confluenceTd"><p>A is an Array and n is an int</p></td><td class="confluenceTd"><p>returns the nth element in the array A. The first element has index 0 e.g. if A is an array comprising of ['foo', 'bar'] then A[0] returns 'foo' and A[1] returns 'bar'</p></td></tr><tr><td class="confluenceTd"><p>M[key]</p></td><td class="confluenceTd"><p>M is a Map&lt;K, V&gt; and key has type K</p></td><td class="confluenceTd"><p>returns the value corresponding to the key in the map e.g. if M is a map comprising of {'f' -&gt; 'foo', 'b' -&gt; 'bar', 'all' -&gt; 'foobar'} then M['all'] returns 'foobar'</p></td></tr><tr><td class="confluenceTd"><p>S.x</p></td><td class="confluenceTd"><p>S is a struct</p></td><td class="confluenceTd"><p>returns the x field of S e.g for struct foobar {int foo, int bar} foobar.foo returns the integer stored in the foo field of the struct.</p></td></tr></tbody></table></div><h3 id="Tutorial-BuiltInFunctions">Built In Functions</h3><ul><li>Hive supports the following built in functions:<br> <a href="http://svn.apache.org/viewvc/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/FunctionRegistry.java?view=markup" class="external-link" rel="nofollow">(Function list in source code: FunctionRegistry.java)</a></li></ul><div class="table-wrap"><table class="confluenceTable tablesorter"><thead><tr class="sortableHeader"><th class="confluenceTh sortableHeader" data-column="0"><div class="tablesorter-header-inner"><p><strong>Return Type</strong></p></div></th><th class="confluenceTh sortableHeader" data-column="1"><div class="tablesorter-header-inner"><p><strong>Function Name (Signature)</strong></p></div></th><th class="confluenceTh sortableHeader" data-column="2"><div class="tablesorter-header-inner"><p><strong>Description</strong></p></div></th></tr></thead><tbody><tr><td class="confluenceTd"><p>BIGINT</p></td><td class="confluenceTd"><p>round(double a)</p></td><td class="confluenceTd"><p>returns the rounded BIGINT value of the double</p></td></tr><tr><td class="confluenceTd"><p>BIGINT</p></td><td class="confluenceTd"><p>floor(double a)</p></td><td class="confluenceTd"><p>returns the maximum BIGINT value that is equal or less than the double</p></td></tr><tr><td class="confluenceTd"><p>BIGINT</p></td><td class="confluenceTd"><p>ceil(double a)</p></td><td class="confluenceTd"><p>returns the minimum BIGINT value that is equal or greater than the double</p></td></tr><tr><td class="confluenceTd"><p>double</p></td><td class="confluenceTd"><p>rand(), rand(int seed)</p></td><td class="confluenceTd"><p>returns a random number (that changes from row to row). Specifiying the seed will make sure the generated random number sequence is deterministic.</p></td></tr><tr><td class="confluenceTd"><p>string</p></td><td class="confluenceTd"><p>concat(string A, string B,...)</p></td><td class="confluenceTd"><p>returns the string resulting from concatenating B after A. For example, concat('foo', 'bar') results in 'foobar'. This function accepts arbitrary number of arguments and return the concatenation of all of them.</p></td></tr><tr><td class="confluenceTd"><p>string</p></td><td class="confluenceTd"><p>substr(string A, int start)</p></td><td class="confluenceTd"><p>returns the substring of A starting from start position till the end of string A. For example, substr('foobar', 4) results in 'bar'</p></td></tr><tr><td class="confluenceTd"><p>string</p></td><td class="confluenceTd"><p>substr(string A, int start, int length)</p></td><td class="confluenceTd"><p>returns the substring of A starting from start position with the given length e.g. substr('foobar', 4, 2) results in 'ba'</p></td></tr><tr><td class="confluenceTd"><p>string</p></td><td class="confluenceTd"><p>upper(string A)</p></td><td class="confluenceTd"><p>returns the string resulting from converting all characters of A to upper case e.g. upper('fOoBaR') results in 'FOOBAR'</p></td></tr><tr><td class="confluenceTd"><p>string</p></td><td class="confluenceTd"><p>ucase(string A)</p></td><td class="confluenceTd"><p>Same as upper</p></td></tr><tr><td class="confluenceTd"><p>string</p></td><td class="confluenceTd"><p>lower(string A)</p></td><td class="confluenceTd"><p>returns the string resulting from converting all characters of B to lower case e.g. lower('fOoBaR') results in 'foobar'</p></td></tr><tr><td class="confluenceTd"><p>string</p></td><td class="confluenceTd"><p>lcase(string A)</p></td><td class="confluenceTd"><p>Same as lower</p></td></tr><tr><td class="confluenceTd"><p>string</p></td><td class="confluenceTd"><p>trim(string A)</p></td><td class="confluenceTd"><p>returns the string resulting from trimming spaces from both ends of A e.g. trim(' foobar ') results in 'foobar'</p></td></tr><tr><td class="confluenceTd"><p>string</p></td><td class="confluenceTd"><p>ltrim(string A)</p></td><td class="confluenceTd"><p>returns the string resulting from trimming spaces from the beginning(left hand side) of A. For example, ltrim(' foobar ') results in 'foobar '</p></td></tr><tr><td class="confluenceTd"><p>string</p></td><td class="confluenceTd"><p>rtrim(string A)</p></td><td class="confluenceTd"><p>returns the string resulting from trimming spaces from the end(right hand side) of A. For example, rtrim(' foobar ') results in ' foobar'</p></td></tr><tr><td class="confluenceTd"><p>string</p></td><td class="confluenceTd"><p>regexp_replace(string A, string B, string C)</p></td><td class="confluenceTd"><p>returns the string resulting from replacing all substrings in B that match the Java regular expression syntax(See <a href="http://java.sun.com/j2se/1.4.2/docs/api/java/util/regex/Pattern.html" class="external-link" rel="nofollow">Java regular expressions syntax</a>) with C. For example, regexp_replace('foobar', 'oo|ar', ) returns 'fb'</p></td></tr><tr><td class="confluenceTd"><p>int</p></td><td class="confluenceTd"><p>size(Map&lt;K.V&gt;)</p></td><td class="confluenceTd"><p>returns the number of elements in the map type</p></td></tr><tr><td class="confluenceTd"><p>int</p></td><td class="confluenceTd"><p>size(Array&lt;T&gt;)</p></td><td class="confluenceTd"><p>returns the number of elements in the array type</p></td></tr><tr><td class="confluenceTd"><p><em>value of &lt;type&gt;</em></p></td><td class="confluenceTd"><p>cast(<em>&lt;expr&gt;</em> as <em>&lt;type&gt;</em>)</p></td><td class="confluenceTd"><p>converts the results of the expression expr to &lt;type&gt; e.g. cast('1' as BIGINT) will convert the string '1' to it integral representation. A null is returned if the conversion does not succeed.</p></td></tr><tr><td class="confluenceTd"><p>string</p></td><td class="confluenceTd"><p>from_unixtime(int unixtime)</p></td><td class="confluenceTd"><p>convert the number of seconds from unix epoch (1970-01-01 00:00:00 UTC) to a string representing the timestamp of that moment in the current system time zone in the format of "1970-01-01 00:00:00"</p></td></tr><tr><td class="confluenceTd"><p>string</p></td><td class="confluenceTd"><p>to_date(string timestamp)</p></td><td class="confluenceTd"><p>Return the date part of a timestamp string: to_date("1970-01-01 00:00:00") = "1970-01-01"</p></td></tr><tr><td class="confluenceTd"><p>int</p></td><td class="confluenceTd"><p>year(string date)</p></td><td class="confluenceTd"><p>Return the year part of a date or a timestamp string: year("1970-01-01 00:00:00") = 1970, year("1970-01-01") = 1970</p></td></tr><tr><td class="confluenceTd"><p>int</p></td><td class="confluenceTd"><p>month(string date)</p></td><td class="confluenceTd"><p>Return the month part of a date or a timestamp string: month("1970-11-01 00:00:00") = 11, month("1970-11-01") = 11</p></td></tr><tr><td class="confluenceTd"><p>int</p></td><td class="confluenceTd"><p>day(string date)</p></td><td class="confluenceTd"><p>Return the day part of a date or a timestamp string: day("1970-11-01 00:00:00") = 1, day("1970-11-01") = 1</p></td></tr><tr><td class="confluenceTd"><p>string</p></td><td class="confluenceTd"><p>get_json_object(string json_string, string path)</p></td><td class="confluenceTd"><p>Extract json object from a json string based on json path specified, and return json string of the extracted json object. It will return null if the input json string is invalid</p></td></tr></tbody></table></div><ul><li>The following built in aggregate functions are supported in Hive:</li></ul><div class="table-wrap"><table class="confluenceTable tablesorter"><thead><tr class="sortableHeader"><th class="confluenceTh sortableHeader" data-column="0"><div class="tablesorter-header-inner"><p><strong>Return Type</strong></p></div></th><th class="confluenceTh sortableHeader" data-column="1"><div class="tablesorter-header-inner"><p><strong>Aggregation Function Name (Signature)</strong></p></div></th><th class="confluenceTh sortableHeader" data-column="2"><div class="tablesorter-header-inner"><p><strong>Description</strong></p></div></th></tr></thead><tbody><tr><td class="confluenceTd"><p>BIGINT</p></td><td class="confluenceTd"><p>count(*), count(expr), count(DISTINCT expr[, expr_.])</p></td><td class="confluenceTd"><p>count(*) - Returns the total number of retrieved rows, including rows containing NULL values; count(expr) - Returns the number of rows for which the supplied expression is non-NULL; count(DISTINCT expr[, expr]) - Returns the number of rows for which the supplied expression(s) are unique and non-NULL.</p></td></tr><tr><td class="confluenceTd"><p>DOUBLE</p></td><td class="confluenceTd"><p>sum(col), sum(DISTINCT col)</p></td><td class="confluenceTd"><p>returns the sum of the elements in the group or the sum of the distinct values of the column in the group</p></td></tr><tr><td class="confluenceTd"><p>DOUBLE</p></td><td class="confluenceTd"><p>avg(col), avg(DISTINCT col)</p></td><td class="confluenceTd"><p>returns the average of the elements in the group or the average of the distinct values of the column in the group</p></td></tr><tr><td class="confluenceTd"><p>DOUBLE</p></td><td class="confluenceTd"><p>min(col)</p></td><td class="confluenceTd"><p>returns the minimum value of the column in the group</p></td></tr><tr><td class="confluenceTd"><p>DOUBLE</p></td><td class="confluenceTd"><p>max(col)</p></td><td class="confluenceTd"><p>returns the maximum value of the column in the group</p></td></tr></tbody></table></div><h2 id="Tutorial-LanguageCapabilities">Language Capabilities</h2><p><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual">Hive query language</a> provides the basic SQL like operations. These operations work on tables or partitions. These operations are:</p><ul><li>Ability to filter rows from a table using a where clause.</li><li>Ability to select certain columns from the table using a select clause.</li><li>Ability to do equi-joins between two tables.</li><li>Ability to evaluate aggregations on multiple "group by" columns for the data stored in a table.</li><li>Ability to store the results of a query into another table.</li><li>Ability to download the contents of a table to a local (e.g., nfs) directory.</li><li>Ability to store the results of a query in a hadoop dfs directory.</li><li>Ability to manage tables and partitions (create, drop and alter).</li><li>Ability to plug in custom scripts in the language of choice for custom map/reduce jobs.</li></ul><h1 id="Tutorial-UsageandExamples">Usage and Examples</h1><p>The following examples highlight some salient features of the system. A detailed set of query test cases can be found at <a href="http://svn.apache.org/viewvc/hive/trunk/ql/src/test/queries/clientpositive/" class="external-link" rel="nofollow">Hive Query Test Cases</a> and the corresponding results can be found at <a href="http://svn.apache.org/viewvc/hive/trunk/ql/src/test/results/clientpositive/" class="external-link" rel="nofollow">Query Test Case Results</a>.</p><style type="text/css">/*<![CDATA[*/
div.rbtoc1424863760170 {padding: 0px;}
div.rbtoc1424863760170 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1424863760170 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class="toc-macro rbtoc1424863760170">
<ul class="toc-indentation">
<li><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#Tutorial-Creating,Showing,Altering,andDroppingTables">Creating, Showing, Altering, and Dropping Tables</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#Tutorial-LoadingData">Loading Data</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#Tutorial-QueryingandInsertingData">Querying and Inserting Data</a></li>
</ul>
</div><h2 id="Tutorial-Creating,Showing,Altering,andDroppingTables">Creating, Showing, Altering, and Dropping Tables</h2><p>See <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL">Hive Data Definition Language</a> for detailed information about creating, showing, altering, and dropping tables.</p><h3 id="Tutorial-CreatingTables">Creating Tables</h3><p>An example statement that would create the page_view table mentioned above would be like:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_912324" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">CREATE TABLE page_view(viewTime INT, userid BIGINT,</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">page_url STRING, referrer_url STRING,</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ip STRING COMMENT </code><code class="java string">'IP Address of the User'</code><code class="java plain">)</code></div><div class="line number4 index3 alt1"><code class="java plain">COMMENT </code><code class="java string">'This is the page view table'</code></div><div class="line number5 index4 alt2"><code class="java plain">PARTITIONED BY(dt STRING, country STRING)</code></div><div class="line number6 index5 alt1"><code class="java plain">STORED AS SEQUENCEFILE;</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>In this example the columns of the table are specified with the corresponding types. Comments can be attached both at the column level as well as at the table level. Additionally the partitioned by clause defines the partitioning columns which are different from the data columns and are actually not stored with the data. When specified in this way, the data in the files is assumed to be delimited with ASCII 001(ctrl-A) as the field delimiter and newline as the row delimiter.</p><p>The field delimiter can be parametrized if the data is not in the above format as illustrated in the following example:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_255640" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">CREATE TABLE page_view(viewTime INT, userid BIGINT,</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">page_url STRING, referrer_url STRING,</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ip STRING COMMENT </code><code class="java string">'IP Address of the User'</code><code class="java plain">)</code></div><div class="line number4 index3 alt1"><code class="java plain">COMMENT </code><code class="java string">'This is the page view table'</code></div><div class="line number5 index4 alt2"><code class="java plain">PARTITIONED BY(dt STRING, country STRING)</code></div><div class="line number6 index5 alt1"><code class="java plain">ROW FORMAT DELIMITED</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">FIELDS TERMINATED BY </code><code class="java string">'1'</code></div><div class="line number8 index7 alt1"><code class="java plain">STORED AS SEQUENCEFILE;</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>The row deliminator currently cannot be changed since it is not determined by Hive but Hadoop. e delimiters.</p><p>It is also a good idea to bucket the tables on certain columns so that efficient sampling queries can be executed against the data set. If bucketing is absent, random sampling can still be done on the table but it is not efficient as the query has to scan all the data. The following example illustrates the case of the page_view table that is bucketed on the userid column:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_268797" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">CREATE TABLE page_view(viewTime INT, userid BIGINT,</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">page_url STRING, referrer_url STRING,</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ip STRING COMMENT </code><code class="java string">'IP Address of the User'</code><code class="java plain">)</code></div><div class="line number4 index3 alt1"><code class="java plain">COMMENT </code><code class="java string">'This is the page view table'</code></div><div class="line number5 index4 alt2"><code class="java plain">PARTITIONED BY(dt STRING, country STRING)</code></div><div class="line number6 index5 alt1"><code class="java plain">CLUSTERED BY(userid) SORTED BY(viewTime) INTO </code><code class="java value">32</code> <code class="java plain">BUCKETS</code></div><div class="line number7 index6 alt2"><code class="java plain">ROW FORMAT DELIMITED</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">FIELDS TERMINATED BY </code><code class="java string">'1'</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">COLLECTION ITEMS TERMINATED BY </code><code class="java string">'2'</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">MAP KEYS TERMINATED BY </code><code class="java string">'3'</code></div><div class="line number11 index10 alt2"><code class="java plain">STORED AS SEQUENCEFILE;</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>In the example above, the table is clustered by a hash function of userid into 32 buckets. Within each bucket the data is sorted in increasing order of viewTime. Such an organization allows the user to do efficient sampling on the clustered column - in this case userid. The sorting property allows internal operators to take advantage of the better-known data structure while evaluating queries with greater efficiency.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_238090" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">CREATE TABLE page_view(viewTime INT, userid BIGINT,</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">page_url STRING, referrer_url STRING,</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">friends ARRAY&lt;BIGINT&gt;, properties MAP&lt;STRING, STRING&gt;</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ip STRING COMMENT </code><code class="java string">'IP Address of the User'</code><code class="java plain">)</code></div><div class="line number5 index4 alt2"><code class="java plain">COMMENT </code><code class="java string">'This is the page view table'</code></div><div class="line number6 index5 alt1"><code class="java plain">PARTITIONED BY(dt STRING, country STRING)</code></div><div class="line number7 index6 alt2"><code class="java plain">CLUSTERED BY(userid) SORTED BY(viewTime) INTO </code><code class="java value">32</code> <code class="java plain">BUCKETS</code></div><div class="line number8 index7 alt1"><code class="java plain">ROW FORMAT DELIMITED</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">FIELDS TERMINATED BY </code><code class="java string">'1'</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">COLLECTION ITEMS TERMINATED BY </code><code class="java string">'2'</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">MAP KEYS TERMINATED BY </code><code class="java string">'3'</code></div><div class="line number12 index11 alt1"><code class="java plain">STORED AS SEQUENCEFILE;</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>In this example the columns that comprise of the table row are specified in a similar way as the definition of types. Comments can be attached both at the column level as well as at the table level. Additionally the partitioned by clause defines the partitioning columns which are different from the data columns and are actually not stored with the data. The CLUSTERED BY clause specifies which column to use for bucketing as well as how many buckets to create. The delimited row format specifies how the rows are stored in the hive table. In the case of the delimited format, this specifies how the fields are terminated, how the items within collections (arrays or maps) are terminated and how the map keys are terminated. STORED AS SEQUENCEFILE indicates that this data is stored in a binary format (using hadoop SequenceFiles) on hdfs. The values shown for the ROW FORMAT and STORED AS clauses in the above example represent the system defaults.</p><p>Table names and column names are case insensitive.</p><h3 id="Tutorial-BrowsingTablesandPartitions">Browsing Tables and Partitions</h3><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_708384" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">SHOW TABLES;</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>To list existing tables in the warehouse; there are many of these, likely more than you want to browse.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_49146" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">SHOW TABLES </code><code class="java string">'page.*'</code><code class="java plain">;</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>To list tables with prefix 'page'. The pattern follows Java regular expression syntax (so the period is a wildcard).</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_68314" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">SHOW PARTITIONS page_view;</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>To list partitions of a table. If the table is not a partitioned table then an error is thrown.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_432601" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">DESCRIBE page_view;</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>To list columns and column types of table.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_556450" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">DESCRIBE EXTENDED page_view;</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>To list columns and all other properties of table. This prints lot of information and that too not in a pretty format. Usually used for debugging.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_772975" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">DESCRIBE EXTENDED page_view PARTITION (ds=</code><code class="java string">'2008-08-08'</code><code class="java plain">);</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>To list columns and all other properties of a partition. This also prints lot of information which is usually used for debugging.</p><h3 id="Tutorial-AlteringTables">Altering Tables</h3><p>To rename existing table to a new name. If a table with new name already exists then an error is returned:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_702607" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">ALTER TABLE old_table_name RENAME TO new_table_name;</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>To rename the columns of an existing table. Be sure to use the same column types, and to include an entry for each preexisting column:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_202468" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">ALTER TABLE old_table_name REPLACE COLUMNS (col1 TYPE, ...);</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>To add columns to an existing table:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_431948" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">ALTER TABLE tab1 ADD COLUMNS (c1 INT COMMENT </code><code class="java string">'a new int column'</code><code class="java plain">, c2 STRING DEFAULT </code><code class="java string">'def val'</code><code class="java plain">);</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>Note that a change in the schema (such as the adding of the columns), preserves the schema for the old partitions of the table in case it is a partitioned table. All the queries that access these columns and run over the old partitions implicitly return a null value or the specified default values for these columns.</p><p>In the later versions we can make the behavior of assuming certain values as opposed to throwing an error in case the column is not found in a particular partition configurable.</p><h3 id="Tutorial-DroppingTablesandPartitions">Dropping Tables and Partitions</h3><p>Dropping tables is fairly trivial. A drop on the table would implicitly drop any indexes(this is a future feature) that would have been built on the table. The associated command is</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_38491" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">DROP TABLE pv_users;</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>To dropping a partition. Alter the table to drop the partition.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_961311" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">ALTER TABLE pv_users DROP PARTITION (ds=</code><code class="java string">'2008-08-08'</code><code class="java plain">)</code></div></div></td></tr></tbody></table></div></div>
</div></div><ul><li>Note that any data for this table or partitions will be dropped and may not be recoverable. *</li></ul><h2 id="Tutorial-LoadingData">Loading Data</h2><p>There are multiple ways to load data into Hive tables. The user can create an external table that points to a specified location within <a href="http://hadoop.apache.org/common/docs/current/hdfs_design.html" class="external-link" rel="nofollow">HDFS</a>. In this particular usage, the user can copy a file into the specified location using the HDFS put or copy commands and create a table pointing to this location with all the relevant row format information. Once this is done, the user can transform the data and insert them into any other Hive table. For example, if the file /tmp/pv_2008-06-08.txt contains comma separated page views served on 2008-06-08, and this needs to be loaded into the page_view table in the appropriate partition, the following sequence of commands can achieve this:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_316484" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">CREATE EXTERNAL TABLE page_view_stg(viewTime INT, userid BIGINT,</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">page_url STRING, referrer_url STRING,</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ip STRING COMMENT </code><code class="java string">'IP Address of the User'</code><code class="java plain">,</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">country STRING COMMENT </code><code class="java string">'country of origination'</code><code class="java plain">)</code></div><div class="line number5 index4 alt2"><code class="java plain">COMMENT </code><code class="java string">'This is the staging page view table'</code></div><div class="line number6 index5 alt1"><code class="java plain">ROW FORMAT DELIMITED FIELDS TERMINATED BY </code><code class="java string">'44'</code> <code class="java plain">LINES TERMINATED BY </code><code class="java string">'12'</code></div><div class="line number7 index6 alt2"><code class="java plain">STORED AS TEXTFILE</code></div><div class="line number8 index7 alt1"><code class="java plain">LOCATION </code><code class="java string">'/user/data/staging/page_view'</code><code class="java plain">;</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1"><code class="java plain">hadoop dfs -put /tmp/pv_2008-</code><code class="java value">06</code><code class="java plain">-</code><code class="java value">08</code><code class="java plain">.txt /user/data/staging/page_view</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="java plain">FROM page_view_stg pvs</code></div><div class="line number13 index12 alt2"><code class="java plain">INSERT OVERWRITE TABLE page_view PARTITION(dt=</code><code class="java string">'2008-06-08'</code><code class="java plain">, country=</code><code class="java string">'US'</code><code class="java plain">)</code></div><div class="line number14 index13 alt1"><code class="java plain">SELECT pvs.viewTime, pvs.userid, pvs.page_url, pvs.referrer_url, </code><code class="java keyword">null</code><code class="java plain">, </code><code class="java keyword">null</code><code class="java plain">, pvs.ip</code></div><div class="line number15 index14 alt2"><code class="java plain">WHERE pvs.country = </code><code class="java string">'US'</code><code class="java plain">;</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>In the example above nulls are inserted for the array and map types in the destination tables but potentially these can also come from the external table if the proper row formats are specified.</p><p>This method is useful if there is already legacy data in HDFS on which the user wants to put some metadata so that the data can be queried and manipulated using Hive.</p><p>Additionally, the system also supports syntax that can load the data from a file in the local files system directly into a Hive table where the input data format is the same as the table format. If /tmp/pv_2008-06-08_us.txt already contains the data for US, then we do not need any additional filtering as shown in the previous example. The load in this case can be done using the following syntax:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_444734" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">LOAD DATA LOCAL INPATH /tmp/pv_2008-</code><code class="java value">06</code><code class="java plain">-08_us.txt INTO TABLE page_view PARTITION(date=</code><code class="java string">'2008-06-08'</code><code class="java plain">, country=</code><code class="java string">'US'</code><code class="java plain">)</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>The path argument can take a directory (in which case all the files in the directory are loaded), a single file name, or a wildcard (in which case all the matching files are uploaded). If the argument is a directory - it cannot contain subdirectories. Similarly - the wildcard must match file names only.</p><p>In the case that the input file /tmp/pv_2008-06-08_us.txt is very large, the user may decide to do a parallel load of the data (using tools that are external to Hive). Once the file is in HDFS - the following syntax can be used to load the data into a Hive table:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_617039" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">LOAD DATA INPATH </code><code class="java string">'/user/data/pv_2008-06-08_us.txt'</code> <code class="java plain">INTO TABLE page_view PARTITION(date=</code><code class="java string">'2008-06-08'</code><code class="java plain">, country=</code><code class="java string">'US'</code><code class="java plain">)</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>It is assumed that the array and map fields in the input.txt files are null fields for these examples.</p><p>See <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DML">Hive Data Manipulation Language</a> for more information about loading data into Hive tables.</p><h2 id="Tutorial-QueryingandInsertingData">Querying and Inserting Data</h2><style type="text/css">/*<![CDATA[*/
div.rbtoc1424863760903 {padding: 0px;}
div.rbtoc1424863760903 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1424863760903 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class="toc-macro rbtoc1424863760903">
<ul class="toc-indentation">
<li><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#Tutorial-SimpleQuery">Simple Query</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#Tutorial-PartitionBasedQuery">Partition Based Query</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#Tutorial-Joins">Joins</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#Tutorial-Aggregations">Aggregations</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#Tutorial-MultiTable/FileInserts">Multi Table/File Inserts</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#Tutorial-Dynamic-PartitionInsert">Dynamic-Partition Insert</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#Tutorial-InsertingintoLocalFiles">Inserting into Local Files</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#Tutorial-Sampling">Sampling</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#Tutorial-UnionAll">Union All</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#Tutorial-ArrayOperations">Array Operations</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#Tutorial-Map(AssociativeArrays)Operations">Map (Associative Arrays) Operations</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#Tutorial-CustomMap/ReduceScripts">Custom Map/Reduce Scripts</a></li>
<li><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#Tutorial-Co-Groups">Co-Groups</a></li>
</ul>
</div><p>The Hive query operations are documented in <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+Select">Select</a>, and the insert operations are documented in <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DML#LanguageManualDML-InsertingdataintoHiveTablesfromqueries">Inserting data into Hive Tables from queries</a> and <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DML#LanguageManualDML-Writingdataintothefilesystemfromqueries">Writing data into the filesystem from queries</a>.</p><h3 id="Tutorial-SimpleQuery">Simple Query</h3><p>For all the active users, one can use the query of the following form:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_261817" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">INSERT OVERWRITE TABLE user_active</code></div><div class="line number2 index1 alt1"><code class="java plain">SELECT user.*</code></div><div class="line number3 index2 alt2"><code class="java plain">FROM user</code></div><div class="line number4 index3 alt1"><code class="java plain">WHERE user.active = </code><code class="java value">1</code><code class="java plain">;</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>Note that unlike SQL, we always insert the results into a table. We will illustrate later how the user can inspect these results and even dump them to a local file. You can also run the following query on Hive CLI:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_609515" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">SELECT user.*</code></div><div class="line number2 index1 alt1"><code class="java plain">FROM user</code></div><div class="line number3 index2 alt2"><code class="java plain">WHERE user.active = </code><code class="java value">1</code><code class="java plain">;</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>This will be internally rewritten to some temporary file and displayed to the Hive client side.</p><h3 id="Tutorial-PartitionBasedQuery">Partition Based Query</h3><p>What partitions to use in a query is determined automatically by the system on the basis of where clause conditions on partition columns. For example, in order to get all the page_views in the month of 03/2008 referred from domain xyz.com, one could write the following query:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_579324" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">INSERT OVERWRITE TABLE xyz_com_page_views</code></div><div class="line number2 index1 alt1"><code class="java plain">SELECT page_views.*</code></div><div class="line number3 index2 alt2"><code class="java plain">FROM page_views</code></div><div class="line number4 index3 alt1"><code class="java plain">WHERE page_views.date &gt;= </code><code class="java string">'2008-03-01'</code> <code class="java plain">AND page_views.date &lt;= </code><code class="java string">'2008-03-31'</code> <code class="java plain">AND</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">page_views.referrer_url like </code><code class="java string">'%xyz.com'</code><code class="java plain">;</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>Note that page_views.date is used here because the table (above) was defined with PARTITIONED BY(date DATETIME, country STRING) ; if you name your partition something different, don't expect .date to do what you think!</p><h3 id="Tutorial-Joins">Joins</h3><p>In order to get a demographic breakdown (by gender) of page_view of 2008-03-03 one would need to join the page_view table and the user table on the userid column. This can be accomplished with a join as shown in the following query:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_220483" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">INSERT OVERWRITE TABLE pv_users</code></div><div class="line number2 index1 alt1"><code class="java plain">SELECT pv.*, u.gender, u.age</code></div><div class="line number3 index2 alt2"><code class="java plain">FROM user u JOIN page_view pv ON (pv.userid = u.id)</code></div><div class="line number4 index3 alt1"><code class="java plain">WHERE pv.date = </code><code class="java string">'2008-03-03'</code><code class="java plain">;</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>In order to do outer joins the user can qualify the join with LEFT OUTER, RIGHT OUTER or FULL OUTER keywords in order to indicate the kind of outer join (left preserved, right preserved or both sides preserved). For example, in order to do a full outer join in the query above, the corresponding syntax would look like the following query:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_309987" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">INSERT OVERWRITE TABLE pv_users</code></div><div class="line number2 index1 alt1"><code class="java plain">SELECT pv.*, u.gender, u.age</code></div><div class="line number3 index2 alt2"><code class="java plain">FROM user u FULL OUTER JOIN page_view pv ON (pv.userid = u.id)</code></div><div class="line number4 index3 alt1"><code class="java plain">WHERE pv.date = </code><code class="java string">'2008-03-03'</code><code class="java plain">;</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>In order check the existence of a key in another table, the user can use LEFT SEMI JOIN as illustrated by the following example.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_41530" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">INSERT OVERWRITE TABLE pv_users</code></div><div class="line number2 index1 alt1"><code class="java plain">SELECT u.*</code></div><div class="line number3 index2 alt2"><code class="java plain">FROM user u LEFT SEMI JOIN page_view pv ON (pv.userid = u.id)</code></div><div class="line number4 index3 alt1"><code class="java plain">WHERE pv.date = </code><code class="java string">'2008-03-03'</code><code class="java plain">;</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>In order to join more than one tables, the user can use the following syntax:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_675837" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">INSERT OVERWRITE TABLE pv_friends</code></div><div class="line number2 index1 alt1"><code class="java plain">SELECT pv.*, u.gender, u.age, f.friends</code></div><div class="line number3 index2 alt2"><code class="java plain">FROM page_view pv JOIN user u ON (pv.userid = u.id) JOIN friend_list f ON (u.id = f.uid)</code></div><div class="line number4 index3 alt1"><code class="java plain">WHERE pv.date = </code><code class="java string">'2008-03-03'</code><code class="java plain">;</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>Note that Hive only supports <a href="http://en.wikipedia.org/wiki/Join_(SQL)#Equi-join" class="external-link" rel="nofollow">equi-joins</a>. Also it is best to put the largest table on the rightmost side of the join to get the best performance.</p><h3 id="Tutorial-Aggregations">Aggregations</h3><p>In order to count the number of distinct users by gender one could write the following query:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_172705" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">INSERT OVERWRITE TABLE pv_gender_sum</code></div><div class="line number2 index1 alt1"><code class="java plain">SELECT pv_users.gender, count (DISTINCT pv_users.userid)</code></div><div class="line number3 index2 alt2"><code class="java plain">FROM pv_users</code></div><div class="line number4 index3 alt1"><code class="java plain">GROUP BY pv_users.gender;</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>Multiple aggregations can be done at the same time, however, no two aggregations can have different DISTINCT columns .e.g while the following is possible</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_948447" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">INSERT OVERWRITE TABLE pv_gender_agg</code></div><div class="line number2 index1 alt1"><code class="java plain">SELECT pv_users.gender, count(DISTINCT pv_users.userid), count(*), sum(DISTINCT pv_users.userid)</code></div><div class="line number3 index2 alt2"><code class="java plain">FROM pv_users</code></div><div class="line number4 index3 alt1"><code class="java plain">GROUP BY pv_users.gender;</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>however, the following query is not allowed</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_430657" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">INSERT OVERWRITE TABLE pv_gender_agg</code></div><div class="line number2 index1 alt1"><code class="java plain">SELECT pv_users.gender, count(DISTINCT pv_users.userid), count(DISTINCT pv_users.ip)</code></div><div class="line number3 index2 alt2"><code class="java plain">FROM pv_users</code></div><div class="line number4 index3 alt1"><code class="java plain">GROUP BY pv_users.gender;</code></div></div></td></tr></tbody></table></div></div>
</div></div><h3 id="Tutorial-MultiTable/FileInserts">Multi Table/File Inserts</h3><p>The output of the aggregations or simple selects can be further sent into multiple tables or even to hadoop dfs files (which can then be manipulated using hdfs utilities). e.g. if along with the gender breakdown, one needed to find the breakdown of unique page views by age, one could accomplish that with the following query:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_858862" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">FROM pv_users</code></div><div class="line number2 index1 alt1"><code class="java plain">INSERT OVERWRITE TABLE pv_gender_sum</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">SELECT pv_users.gender, count_distinct(pv_users.userid)</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">GROUP BY pv_users.gender</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="java plain">INSERT OVERWRITE DIRECTORY </code><code class="java string">'/user/data/tmp/pv_age_sum'</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">SELECT pv_users.age, count_distinct(pv_users.userid)</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">GROUP BY pv_users.age;</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>The first insert clause sends the results of the first group by to a Hive table while the second one sends the results to a hadoop dfs files.</p><h3 id="Tutorial-Dynamic-PartitionInsert">Dynamic-Partition Insert</h3><p>In the previous examples, the user has to know which partition to insert into and only one partition can be inserted in one insert statement. If you want to load into multiple partitions, you have to use multi-insert statement as illustrated below.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_295788" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">FROM page_view_stg pvs</code></div><div class="line number2 index1 alt1"><code class="java plain">INSERT OVERWRITE TABLE page_view PARTITION(dt=</code><code class="java string">'2008-06-08'</code><code class="java plain">, country=</code><code class="java string">'US'</code><code class="java plain">)</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">SELECT pvs.viewTime, pvs.userid, pvs.page_url, pvs.referrer_url, </code><code class="java keyword">null</code><code class="java plain">, </code><code class="java keyword">null</code><code class="java plain">, pvs.ip WHERE pvs.country = </code><code class="java string">'US'</code></div><div class="line number4 index3 alt1"><code class="java plain">INSERT OVERWRITE TABLE page_view PARTITION(dt=</code><code class="java string">'2008-06-08'</code><code class="java plain">, country=</code><code class="java string">'CA'</code><code class="java plain">)</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">SELECT pvs.viewTime, pvs.userid, pvs.page_url, pvs.referrer_url, </code><code class="java keyword">null</code><code class="java plain">, </code><code class="java keyword">null</code><code class="java plain">, pvs.ip WHERE pvs.country = </code><code class="java string">'CA'</code></div><div class="line number6 index5 alt1"><code class="java plain">INSERT OVERWRITE TABLE page_view PARTITION(dt=</code><code class="java string">'2008-06-08'</code><code class="java plain">, country=</code><code class="java string">'UK'</code><code class="java plain">)</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">SELECT pvs.viewTime, pvs.userid, pvs.page_url, pvs.referrer_url, </code><code class="java keyword">null</code><code class="java plain">, </code><code class="java keyword">null</code><code class="java plain">, pvs.ip WHERE pvs.country = </code><code class="java string">'UK'</code><code class="java plain">;</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>In order to load data into all country partitions in a particular day, you have to add an insert statement for each country in the input data. This is very inconvenient since you have to have the priori knowledge of the list of countries exist in the input data and create the partitions beforehand. If the list changed for another day, you have to modify your insert DML as well as the partition creation DDLs. It is also inefficient since each insert statement may be turned into a MapReduce Job.</p><p><em>Dynamic-partition insert</em> (or multi-partition insert) is designed to solve this problem by dynamically determining which partitions should be created and populated while scanning the input table. This is a newly added feature that is only available from version 0.6.0. In the dynamic partition insert, the input column values are evaluated to determine which partition this row should be inserted into. If that partition has not been created, it will create that partition automatically. Using this feature you need only one insert statement to create and populate all necessary partitions. In addition, since there is only one insert statement, there is only one corresponding MapReduce job. This significantly improves performance and reduce the Hadoop cluster workload comparing to the multiple insert case.</p><p>Below is an example of loading data to all country partitions using one insert statement:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_84183" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">FROM page_view_stg pvs</code></div><div class="line number2 index1 alt1"><code class="java plain">INSERT OVERWRITE TABLE page_view PARTITION(dt=</code><code class="java string">'2008-06-08'</code><code class="java plain">, country)</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">SELECT pvs.viewTime, pvs.userid, pvs.page_url, pvs.referrer_url, </code><code class="java keyword">null</code><code class="java plain">, </code><code class="java keyword">null</code><code class="java plain">, pvs.ip, pvs.country</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>There are several syntactic differences from the multi-insert statement:</p><ul><li>country appears in the PARTITION specification, but with no value associated. In this case, country is a <em>dynamic partition column</em>. On the other hand, ds has a value associated with it, which means it is a <em>static partition column</em>. If a column is dynamic partition column, its value will be coming from the input column. Currently we only allow dynamic partition columns to be the last column(s) in the partition clause because the partition column order indicates its hierarchical order (meaning dt is the root partition, and country is the child partition). You cannot specify a partition clause with (dt, country='US') because that means you need to update all partitions with any date and its country sub-partition is 'US'.</li><li>An additional pvs.country column is added in the select statement. This is the corresponding input column for the dynamic partition column. Note that you do not need to add an input column for the static partition column because its value is already known in the PARTITION clause. Note that the dynamic partition values are selected by ordering, not name, and taken as the last columns from the select clause.</li></ul><p>Semantics of the dynamic partition insert statement:</p><ul><li>When there are already non-empty partitions exists for the dynamic partition columns, (e.g., country='CA' exists under some ds root partition), it will be overwritten if the dynamic partition insert saw the same value (say 'CA') in the input data. This is in line with the 'insert overwrite' semantics. However, if the partition value 'CA' does not appear in the input data, the existing partition will not be overwritten.</li><li>Since a Hive partition corresponds to a directory in HDFS, the partition value has to conform to the HDFS path format (URI in Java). Any character having a special meaning in URI (e.g., '%', ':', '/', '#') will be escaped with '%' followed by 2 bytes of its ASCII value.</li><li>If the input column is a type different than STRING, its value will be first converted to STRING to be used to construct the HDFS path.</li><li>If the input column value is NULL or empty string, the row will be put into a special partition, whose name is controlled by the hive parameter hive.exec.default.partition.name. The default value is <code>HIVE_DEFAULT_PARTITION</code>{<em>}</em>. Basically this partition will contain all "bad" rows whose value are not valid partition names. The caveat of this approach is that the bad value will be lost and is replaced by <code>HIVE_DEFAULT_PARTITION</code>{<em>}</em> if you select them Hive. JIRA HIVE-1309 is a solution to let user specify "bad file" to retain the input partition column values as well.</li><li>Dynamic partition insert could potentially resource hog in that it could generate a large number of partitions in a short time. To get yourself buckled, we define three parameters:<ul><li><strong>hive.exec.max.dynamic.partitions.pernode</strong> (default value being 100) is the maximum dynamic partitions that can be created by each mapper or reducer. If one mapper or reducer created more than that the threshold, a fatal error will be raised from the mapper/reducer (through counter) and the whole job will be killed.</li><li><strong>hive.exec.max.dynamic.partitions</strong> (default value being 1000) is the total number of dynamic partitions could be created by one DML. If each mapper/reducer did not exceed the limit but the total number of dynamic partitions does, then an exception is raised at the end of the job before the intermediate data are moved to the final destination.</li><li><strong>hive.exec.max.created.files</strong> (default value being 100000) is the maximum total number of files created by all mappers and reducers. This is implemented by updating a Hadoop counter by each mapper/reducer whenever a new file is created. If the total number is exceeding hive.exec.max.created.files, a fatal error will be thrown and the job will be killed.</li></ul></li></ul><ul><li>Another situation we want to protect against dynamic partition insert is that the user may accidentally specify all partitions to be dynamic partitions without specifying one static partition, while the original intention is to just overwrite the sub-partitions of one root partition. We define another parameter hive.exec.dynamic.partition.mode=strict to prevent the all-dynamic partition case. In the strict mode, you have to specify at least one static partition. The default mode is strict. In addition, we have a parameter hive.exec.dynamic.partition=true/false to control whether to allow dynamic partition at all. The default value is false.</li><li>In Hive 0.6, dynamic partition insert does not work with hive.merge.mapfiles=true or hive.merge.mapredfiles=true, so it internally turns off the merge parameters. Merging files in dynamic partition inserts are supported in Hive 0.7 (see JIRA HIVE-1307 for details).</li></ul><p>Troubleshooting and best practices:</p><ul><li><p>As stated above, there are too many dynamic partitions created by a particular mapper/reducer, a fatal error could be raised and the job will be killed. The error message looks something like:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_896172" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">hive&gt; set hive.exec.dynamic.partition.mode=nonstrict;</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">hive&gt; FROM page_view_stg pvs</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">INSERT OVERWRITE TABLE page_view PARTITION(dt, country)</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">SELECT pvs.viewTime, pvs.userid, pvs.page_url, pvs.referrer_url, </code><code class="java keyword">null</code><code class="java plain">, </code><code class="java keyword">null</code><code class="java plain">, pvs.ip,</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">from_unixtimestamp(pvs.viewTime, </code><code class="java string">'yyyy-MM-dd'</code><code class="java plain">) ds, pvs.country;</code></div><div class="line number6 index5 alt1"><code class="java plain">...</code></div><div class="line number7 index6 alt2"><code class="java value">2010</code><code class="java plain">-</code><code class="java value">05</code><code class="java plain">-</code><code class="java value">07</code> <code class="java value">11</code><code class="java plain">:</code><code class="java value">10</code><code class="java plain">:</code><code class="java value">19</code><code class="java plain">,</code><code class="java value">816</code> <code class="java plain">Stage-</code><code class="java value">1</code> <code class="java plain">map = </code><code class="java value">0</code><code class="java plain">%,&nbsp; reduce = </code><code class="java value">0</code><code class="java plain">%</code></div><div class="line number8 index7 alt1"><code class="java plain">[Fatal Error] Operator FS_28 (id=</code><code class="java value">41</code><code class="java plain">): fatal error. Killing the job.</code></div><div class="line number9 index8 alt2"><code class="java plain">Ended Job = job_201005052204_28178 with errors</code></div><div class="line number10 index9 alt1"><code class="java plain">...</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>The problem of this that one mapper will take a random set of rows and it is very likely that the number of distinct (dt, country) pairs will exceed the limit of hive.exec.max.dynamic.partitions.pernode. One way around it is to group the rows by the dynamic partition columns in the mapper and distribute them to the reducers where the dynamic partitions will be created. In this case the number of distinct dynamic partitions will be significantly reduced. The above example query could be rewritten to:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_858994" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">hive&gt; set hive.exec.dynamic.partition.mode=nonstrict;</code></div><div class="line number2 index1 alt1"><code class="java plain">hive&gt; FROM page_view_stg pvs</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">INSERT OVERWRITE TABLE page_view PARTITION(dt, country)</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">SELECT pvs.viewTime, pvs.userid, pvs.page_url, pvs.referrer_url, </code><code class="java keyword">null</code><code class="java plain">, </code><code class="java keyword">null</code><code class="java plain">, pvs.ip,</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">from_unixtimestamp(pvs.viewTime, </code><code class="java string">'yyyy-MM-dd'</code><code class="java plain">) ds, pvs.country</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">DISTRIBUTE BY ds, country;</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>This query will generate a MapReduce job rather than Map-only job. The SELECT-clause will be converted to a plan to the mappers and the output will be distributed to the reducers based on the value of (ds, country) pairs. The INSERT-clause will be converted to the plan in the reducer which writes to the dynamic partitions.</p></li></ul><p>Additional documentation:</p><ul><li><a href="https://cwiki.apache.org/confluence/display/Hive/DynamicPartitions">Design Document for Dynamic Partitions</a><ul><li><a href="https://issues.apache.org/jira/secure/attachment/12437909/dp_design.txt" class="external-link" rel="nofollow">Original design doc</a></li><li><a href="https://issues.apache.org/jira/browse/HIVE-936" class="external-link" rel="nofollow">HIVE-936</a></li></ul></li><li><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DML#LanguageManualDML-DynamicPartitionInserts">Hive DML: Dynamic Partition Inserts</a></li><li><a href="https://cwiki.apache.org/confluence/display/Hive/HCatalog+DynamicPartitions">HCatalog Dynamic Partitioning</a><ul><li><a href="https://cwiki.apache.org/confluence/display/Hive/HCatalog+DynamicPartitions#HCatalogDynamicPartitions-UsagewithPig">Usage with Pig</a></li><li><a href="https://cwiki.apache.org/confluence/display/Hive/HCatalog+DynamicPartitions#HCatalogDynamicPartitions-UsagefromMapReduce">Usage from MapReduce</a></li></ul></li></ul><h3 id="Tutorial-InsertingintoLocalFiles">Inserting into Local Files</h3><p>In certain situations you would want to write the output into a local file so that you could load it into an excel spreadsheet. This can be accomplished with the following command:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_899893" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">INSERT OVERWRITE LOCAL DIRECTORY </code><code class="java string">'/tmp/pv_gender_sum'</code></div><div class="line number2 index1 alt1"><code class="java plain">SELECT pv_gender_sum.*</code></div><div class="line number3 index2 alt2"><code class="java plain">FROM pv_gender_sum;</code></div></div></td></tr></tbody></table></div></div>
</div></div><h3 id="Tutorial-Sampling">Sampling</h3><p>The sampling clause allows the users to write queries for samples of the data instead of the whole table. Currently the sampling is done on the columns that are specified in the CLUSTERED BY clause of the CREATE TABLE statement. In the following example we choose 3rd bucket out of the 32 buckets of the pv_gender_sum table:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_200463" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">INSERT OVERWRITE TABLE pv_gender_sum_sample</code></div><div class="line number2 index1 alt1"><code class="java plain">SELECT pv_gender_sum.*</code></div><div class="line number3 index2 alt2"><code class="java plain">FROM pv_gender_sum TABLESAMPLE(BUCKET </code><code class="java value">3</code> <code class="java plain">OUT OF </code><code class="java value">32</code><code class="java plain">);</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>In general the TABLESAMPLE syntax looks like:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_446042" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">TABLESAMPLE(BUCKET x OUT OF y)</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>y has to be a multiple or divisor of the number of buckets in that table as specified at the table creation time. The buckets chosen are determined if bucket_number module y is equal to x. So in the above example the following tablesample clause</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_969975" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">TABLESAMPLE(BUCKET </code><code class="java value">3</code> <code class="java plain">OUT OF </code><code class="java value">16</code><code class="java plain">)</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>would pick out the 3rd and 19th buckets. The buckets are numbered starting from 0.</p><p>On the other hand the tablesample clause</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_694475" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">TABLESAMPLE(BUCKET </code><code class="java value">3</code> <code class="java plain">OUT OF </code><code class="java value">64</code> <code class="java plain">ON userid)</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>would pick out half of the 3rd bucket.</p><h3 id="Tutorial-UnionAll">Union All</h3><p>The language also supports union all, e.g. if we suppose there are two different tables that track which user has published a video and which user has published a comment, the following query joins the results of a union all with the user table to create a single annotated stream for all the video publishing and comment publishing events:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_619845" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">INSERT OVERWRITE TABLE actions_users</code></div><div class="line number2 index1 alt1"><code class="java plain">SELECT u.id, actions.date</code></div><div class="line number3 index2 alt2"><code class="java plain">FROM (</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">SELECT av.uid AS uid</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">FROM action_video av</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">WHERE av.date = </code><code class="java string">'2008-06-03'</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">UNION ALL</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">SELECT ac.uid AS uid</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">FROM action_comment ac</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">WHERE ac.date = </code><code class="java string">'2008-06-03'</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">) actions JOIN users u ON(u.id = actions.uid);</code></div></div></td></tr></tbody></table></div></div>
</div></div><h3 id="Tutorial-ArrayOperations">Array Operations</h3><p>Array columns in tables can be as follows:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_951863" class="syntaxhighlighter nogutter  sql"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="sql keyword">CREATE</code> <code class="sql keyword">TABLE</code> <code class="sql plain">array_table (int_array_column ARRAY&lt;</code><code class="sql keyword">INT</code><code class="sql plain">&gt;);</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>Assuming that pv.friends is of the type ARRAY&lt;INT&gt; (i.e. it is an array of integers), the user can get a specific element in the array by its index as shown in the following command:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_179655" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">SELECT pv.friends[</code><code class="java value">2</code><code class="java plain">]</code></div><div class="line number2 index1 alt1"><code class="java plain">FROM page_views pv;</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>The select expression gets the third item in the pv.friends array.</p><p>The user can also get the length of the array using the size function as shown below:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_202163" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">SELECT pv.userid, size(pv.friends)</code></div><div class="line number2 index1 alt1"><code class="java plain">FROM page_view pv;</code></div></div></td></tr></tbody></table></div></div>
</div></div><h3 id="Tutorial-Map(AssociativeArrays)Operations">Map (Associative Arrays) Operations</h3><p>Maps provide collections similar to associative arrays. Such structures can only be created programmatically currently. We will be extending this soon. For the purpose of the current example assume that pv.properties is of the type map&lt;String, String&gt; i.e. it is an associative array from strings to string. Accordingly, the following query:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_785755" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">INSERT OVERWRITE page_views_map</code></div><div class="line number2 index1 alt1"><code class="java plain">SELECT pv.userid, pv.properties[</code><code class="java string">'page type'</code><code class="java plain">]</code></div><div class="line number3 index2 alt2"><code class="java plain">FROM page_views pv;</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>can be used to select the 'page_type' property from the page_views table.</p><p>Similar to arrays, the size function can also be used to get the number of elements in a map as shown in the following query:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_152319" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">SELECT size(pv.properties)</code></div><div class="line number2 index1 alt1"><code class="java plain">FROM page_view pv;</code></div></div></td></tr></tbody></table></div></div>
</div></div><h3 id="Tutorial-CustomMap/ReduceScripts">Custom Map/Reduce Scripts</h3><p>Users can also plug in their own custom mappers and reducers in the data stream by using features natively supported in the Hive language. e.g. in order to run a custom mapper script - map_script - and a custom reducer script - reduce_script - the user can issue the following command which uses the TRANSFORM clause to embed the mapper and the reducer scripts.</p><p>Note that columns will be transformed to string and delimited by TAB before feeding to the user script, and the standard output of the user script will be treated as TAB-separated string columns. User scripts can output debug information to standard error which will be shown on the task detail page on hadoop.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_423767" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">FROM (</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">FROM pv_users</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">MAP pv_users.userid, pv_users.date</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">USING </code><code class="java string">'map_script'</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">AS dt, uid</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">CLUSTER BY dt) map_output</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;</code><code class="java plain">INSERT OVERWRITE TABLE pv_users_reduced</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">REDUCE map_output.dt, map_output.uid</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">USING </code><code class="java string">'reduce_script'</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">AS date, count;</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>Sample map script (weekday_mapper.py )</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_287421" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java keyword">import</code> <code class="java plain">sys</code></div><div class="line number2 index1 alt1"><code class="java keyword">import</code> <code class="java plain">datetime</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="java keyword">for</code> <code class="java plain">line in sys.stdin:</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">line = line.strip()</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">userid, unixtime = line.split(</code><code class="java string">'\t'</code><code class="java plain">)</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">weekday = datetime.datetime.fromtimestamp(</code><code class="java keyword">float</code><code class="java plain">(unixtime)).isoweekday()</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">print </code><code class="java string">','</code><code class="java plain">.join([userid, str(weekday)])</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>Of course, both MAP and REDUCE are "syntactic sugar" for the more general select transform. The inner query could also have been written as such:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_200930" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">SELECT TRANSFORM(pv_users.userid, pv_users.date) USING </code><code class="java string">'map_script'</code> <code class="java plain">AS dt, uid CLUSTER BY dt FROM pv_users;</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>Schema-less map/reduce: If there is no "AS" clause after "USING map_script", Hive assumes the output of the script contains 2 parts: key which is before the first tab, and value which is the rest after the first tab. Note that this is different from specifying "AS key, value" because in that case value will only contains the portion between the first tab and the second tab if there are multiple tabs.</p><p>In this way, we allow users to migrate old map/reduce scripts without knowing the schema of the map output. User still needs to know the reduce output schema because that has to match what is in the table that we are inserting to.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_806126" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">FROM (</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">FROM pv_users</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">MAP pv_users.userid, pv_users.date</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">USING </code><code class="java string">'map_script'</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">CLUSTER BY key) map_output</code></div><div class="line number6 index5 alt1">&nbsp;</div><div class="line number7 index6 alt2"><code class="java plain">INSERT OVERWRITE TABLE pv_users_reduced</code></div><div class="line number8 index7 alt1">&nbsp;</div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">REDUCE map_output.dt, map_output.uid</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">USING </code><code class="java string">'reduce_script'</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">AS date, count;</code></div></div></td></tr></tbody></table></div></div>
</div></div><p>Distribute By and Sort By: Instead of specifying "cluster by", the user can specify "distribute by" and "sort by", so the partition columns and sort columns can be different. The usual case is that the partition columns are a prefix of sort columns, but that is not required.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_431794" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">FROM (</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">FROM pv_users</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">MAP pv_users.userid, pv_users.date</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">USING </code><code class="java string">'map_script'</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">AS c1, c2, c3</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">DISTRIBUTE BY c2</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">SORT BY c2, c1) map_output</code></div><div class="line number8 index7 alt1">&nbsp;</div><div class="line number9 index8 alt2"><code class="java plain">INSERT OVERWRITE TABLE pv_users_reduced</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">REDUCE map_output.c1, map_output.c2, map_output.c3</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">USING </code><code class="java string">'reduce_script'</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">AS date, count;</code></div></div></td></tr></tbody></table></div></div>
</div></div><h3 id="Tutorial-Co-Groups">Co-Groups</h3><p>Amongst the user community using map/reduce, cogroup is a fairly common operation wherein the data from multiple tables are sent to a custom reducer such that the rows are grouped by the values of certain columns on the tables. With the UNION ALL operator and the CLUSTER BY specification, this can be achieved in the Hive query language in the following way. Suppose we wanted to cogroup the rows from the actions_video and action_comments table on the uid column and send them to the 'reduce_script' custom reducer, the following syntax can be used by the user:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<div><div id="highlighter_453411" class="syntaxhighlighter nogutter  java"><div class="toolbar"><span><a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">FROM (</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">FROM (</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">FROM action_video av</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">SELECT av.uid AS uid, av.id AS id, av.date AS date</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">UNION ALL</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">FROM action_comment ac</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">SELECT ac.uid AS uid, ac.id AS id, ac.date AS date</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">) union_actions</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">SELECT union_actions.uid, union_actions.id, union_actions.date</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">CLUSTER BY union_actions.uid) map</code></div><div class="line number13 index12 alt2">&nbsp;</div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;</code><code class="java plain">INSERT OVERWRITE TABLE actions_reduced</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">SELECT TRANSFORM(map.uid, map.id, map.date) USING </code><code class="java string">'reduce_script'</code> <code class="java plain">AS (uid, id, reduced_val);</code></div></div></td></tr></tbody></table></div></div>
</div></div>
    
        </div>

        <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
         <rdf:Description
    rdf:about="https://cwiki.apache.org/confluence/display/Hive/Tutorial"
    dc:identifier="https://cwiki.apache.org/confluence/display/Hive/Tutorial"
    dc:title="Tutorial"
    trackback:ping="https://cwiki.apache.org/confluence/rpc/trackback/27362061"/>
</rdf:RDF>
-->

                        
    



<div id="likes-and-labels-container"><div id="likes-section"><span class="like-summary"><a href="https://cwiki.apache.org/confluence/display/~zhiwen5717" class="confluence-userlink userlink-0" data-username="zhiwen5717" title="" data-user-hover-bound="true">Whise Zhang</a> likes this</span></div><div id="labels-section" class="pageSection group">
    <div class="labels-editor">
        <span id="labels-section-title" class="label-title">Labels</span>
        <div class="labels-section-content content-column" entityid="27362061" entitytype="page">
	<div class="labels-content">
		
<ul class="label-list label-list-right">
    <li class="no-labels-message-container">
        <span id="labels-section-title-none" class="no-labels-message">
            No labels
        </span>
    </li>
        </ul>
    </div>
</div>    </div>
</div></div>
        
		
            




            
    








                    
    
<div id="comments-section" class="pageSection group">
    
    
    
    
            <div class="bottom-comment-panels comment-panels">
                                    
    


    
            </div>
    
    </div>


            
</div>


    




    
    

    
    
    







    </div><!-- \#main -->
        
    
        
            <div id="footer" style="margin-left: 285px;">

    <section class="footer-body">

                                                <p class="license license-opensource">
                  Powered by a free <b>Atlassian Confluence Open Source Project License</b> granted to Apache Software Foundation. <a href="http://www.atlassian.com/c/conf/11461">Evaluate Confluence today</a>.<br>
                </p>
                        
    

    
        <div class="gliffy-webpanel-footer"><span>This Confluence installation runs a Free Gliffy License - Evaluate the <a href="http://www.gliffy.com/products/confluence-plugin/">Gliffy Confluence Plugin</a> for your Wiki!</span></div>
<ul id="poweredby">
        <li class="noprint">Powered by <a href="http://www.atlassian.com/software/confluence" class="hover-footer-link">Atlassian Confluence</a> <span id="footer-build-information">5.0.3</span>, <a href="http://www.atlassian.com/software/confluence/overview/team-collaboration-software?utm_source=confluence-footer" class="hover-footer-link">Team Collaboration Software</a></li>
        <li class="print-only">Printed by Atlassian Confluence 5.0.3, Team Collaboration Software.</li>
        <li class="noprint"><a href="http://jira.atlassian.com/secure/BrowseProject.jspa?id=10470" class="hover-footer-link">Report a bug</a></li>
        <li class="noprint"><a href="http://www.atlassian.com/about/connected.jsp?s_kwcid=Confluence-stayintouch" class="hover-footer-link">Atlassian News</a></li>
    </ul>

    

            
    
    </section>

</div>

    
</div>

</div><!-- \#full-height-container -->
</div><!-- \#page -->


<div id="fancybox-tmp"></div><div id="fancybox-loading"><div></div></div><div id="fancybox-overlay"></div><div id="fancybox-wrap"><div id="fancybox-outer"><div class="fancybox-bg" id="fancybox-bg-n"></div><div class="fancybox-bg" id="fancybox-bg-ne"></div><div class="fancybox-bg" id="fancybox-bg-e"></div><div class="fancybox-bg" id="fancybox-bg-se"></div><div class="fancybox-bg" id="fancybox-bg-s"></div><div class="fancybox-bg" id="fancybox-bg-sw"></div><div class="fancybox-bg" id="fancybox-bg-w"></div><div class="fancybox-bg" id="fancybox-bg-nw"></div><div id="fancybox-content"></div><a id="fancybox-close"></a><div id="fancybox-title"></div><a href="javascript:;" id="fancybox-left"><span class="fancy-ico" id="fancybox-left-ico"></span></a><a href="javascript:;" id="fancybox-right"><span class="fancy-ico" id="fancybox-right-ico"></span></a></div></div><div id="content-hover-shadow" style="display: none;"><div class="tl"></div><div class="tr"></div><div class="l"></div><div class="r"></div><div class="bl"></div><div class="br"></div><div class="b"></div></div><div id="fileuploadShim" style="position: relative; z-index: 0;"></div><div id="p19f07v6o211gr11nc1r5q1vrn1llf0_html5_container" class="plupload html5" style="position: absolute; width: 1583px; height: 0px; overflow: hidden; z-index: -1; opacity: 0; top: 13030px; left: 0px; background: transparent;"><input id="p19f07v6o211gr11nc1r5q1vrn1llf0_html5" style="font-size: 999px; position: absolute; width: 100%; height: 100%;" type="file" accept="" multiple="multiple"></div><div id="content-hover-0" class="ajs-content-hover"><div class="contents" style="width: 300px;"></div></div></body></html>